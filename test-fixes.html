<!DOCTYPE html>
<html>
<head>
  <title>Test Fixes</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .test { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
    .pass { background: #d4edda; }
    .fail { background: #f8d7da; }
  </style>
</head>
<body>
  <h1>Serpent Town Bug Fix Tests</h1>
  <div id="results"></div>
  
  <script type="module">
    import SerpentTown from './game.js';
    import { openShop } from './src/ui/shop-view.js';
    import { createInitialGameState } from './src/business/economy.js';
    
    const results = [];
    
    // Test 1: Shop modal opens with no snakes
    try {
      const gameState = createInitialGameState();
      openShop(gameState, () => {});
      const modal = document.querySelector('#shop-modal');
      if (modal && modal.style.display === 'flex') {
        results.push({ test: 'Shop modal opens', pass: true });
      } else {
        results.push({ test: 'Shop modal opens', pass: false, error: 'Modal not visible' });
      }
      if (modal) modal.remove();
    } catch (e) {
      results.push({ test: 'Shop modal opens', pass: false, error: e.message });
    }
    
    // Test 2: Reset game has proper cleanup
    try {
      const game = new SerpentTown();
      const hasGameLoop = game.gameLoop !== null;
      if (hasGameLoop) {
        results.push({ test: 'Game loop exists', pass: true });
      } else {
        results.push({ test: 'Game loop exists', pass: false });
      }
    } catch (e) {
      results.push({ test: 'Game loop exists', pass: false, error: e.message });
    }
    
    // Display results
    const resultsDiv = document.getElementById('results');
    results.forEach(r => {
      const div = document.createElement('div');
      div.className = `test ${r.pass ? 'pass' : 'fail'}`;
      div.innerHTML = `
        <strong>${r.test}</strong>: ${r.pass ? '✅ PASS' : '❌ FAIL'}
        ${r.error ? `<br>Error: ${r.error}` : ''}
      `;
      resultsDiv.appendChild(div);
    });
  </script>
</body>
</html>
