# Session Context - 2026-01-13
**Version:** 0.7.7 | **Time:** 16:00-17:00 UTC | **Focus:** Dev Tools + UI Architecture

---

## ğŸ¯ What We Did

### 1. Enhanced Architecture Checks
**Added SMRI modularity validation to npm dev tools:**
- âœ… Modules must only import from facades (`../module/index.js`)
- âœ… SMRI syntax validation (`S{M}.{RRR}.{II}`)
- âœ… Coverage tracking (which modules tested)
- âœ… Dead facade method detection

**Commands:**
```bash
npm run dev:architecture  # Full architecture check
npm run smri:coverage     # Module coverage stats
npm run smri:dead         # Find unused facade methods
```

### 2. Solved Components vs Modules Confusion
**Decision: Keep both separate, no S10+ needed**

**Architecture:**
```
/src/components/  â†’ UI layer (Navigation, SplitScreenDemo, modals)
/src/modules/     â†’ Logic layer (S0-S9: shop, game, auth, etc.)
```

**Key Rules:**
- Components â†’ CAN import Modules âœ…
- Modules â†’ NEVER import Components âŒ
- Components are GENERIC (work across all modules)
- Tested via integration scenarios (not isolated)

**Track usage:**
```bash
npm run smri:list:components  # See which components used
```

### 3. Added Component Coverage Tracking
**Created:**
- `scripts/smri-list-components.cjs` - List all components + usage
- `getComponentCoverage()` - Function in scenarios.js
- `debug/demo-split-screen.html` - Example split-screen demo
- Updated `src/components/README.md` with SMRI integration

**Current Coverage:** 2/7 (29%)
- âœ… Navigation, SnakeDetailModal (in use)
- â³ SplitScreenDemo, TestRenderer (ready)

---

## ğŸ“Š Current State

### Project Health
- **Tests:** 14/14 passing (100%) âœ…
- **Architecture:** 5/5 checks (100%) âœ…
- **Consistency:** 4/6 (67%) - file sizes, archives remain
- **Module Coverage:** 9/11 (82%) - breeding, tutorial untested
- **Facade Usage:** 40/43 (93%) - 3 dead methods identified
- **Component Usage:** 2/7 (29%) - 5 unused

### Module Map (S0-S9)
```
S0: common    - Core utilities, snake avatar, constants
S1: shop      - E-commerce, catalog, economy
S2: game      - Tamagotchi mechanics, care system
S3: auth      - User authentication, password hashing
S4: payment   - Stripe integration (external)
S5: worker    - Backend API (external, needs abstraction)
S6: testing   - Test framework, assertions
S7: breeding  - Genetics calculator (external, untested)
S8: smri      - SMRI test runner
S9: tutorial  - Interactive tutorial (untested)
```

### SMRI Notation Format
```
S{M}.{RRR}.{II}
  M   = Module number (0-9) or submodule (e.g., 2-7)
  RRR = Relations (comma-separated: 1,2,3)
  II  = Iteration (01-99)

Examples:
- S2.7,5,5-1.01  (Game + tutorial + worker + KV)
- S1.1,2.05      (Shop + game interaction)
```

---

## ğŸ”§ Key Scripts Created

### Development Tools
```bash
npm run dev:check          # Full health check (consistency + architecture)
npm run dev:consistency    # Version sync, modules, duplicates, file sizes
npm run dev:architecture   # Dependencies, facades, SMRI, complexity
npm run dev:dead-facades   # Find unused facade exports
```

### SMRI Commands
```bash
npm run smri:list          # List all scenarios
npm run smri:list:scenarios # Scenarios with coverage
npm run smri:list:functions # All module functions
npm run smri:list:components # Component usage
npm run smri:coverage      # Module coverage stats
npm run smri:dead          # Dead facade methods
```

### All Scripts Location
**Path:** `/root/catalog/scripts/`
- `check-consistency.cjs` - Version, modules, duplicates
- `check-architecture.cjs` - Dependencies, facades, SMRI
- `find-dead-facades.cjs` - Unused exports
- `smri-list-scenarios.cjs` - Scenario coverage
- `smri-list-functions.cjs` - Module functions
- `smri-list-components.cjs` - Component usage
- `README.md` - Full documentation

---

## ğŸš¨ Critical Rules (NEVER BREAK)

### Local Servers
**NEVER touch:** `webhook-server.py`, `upload-server.py`
- User manages these manually
- Only deploy Cloudflare Worker (`cd worker && bash cloudflare-deploy.sh`)

### Facade Pattern
**Modules must import ONLY from facades:**
```javascript
// âœ… Correct
import { Economy } from '../modules/shop/index.js';

// âŒ Wrong
import { Economy } from '../modules/shop/business/economy.js';
```

### SMRI Structure
- `.smri/INDEX.md` - Only in root (main navigation)
- `.smri/docs/` - All other documentation
- `.smri/logs/` - Session history

---

## ğŸ“ Important Files Reference

### Configuration
- `package.json` (lines 6-36) - All npm scripts
- `.smri/INDEX.md` (891 lines) - SMRI system rules
- `src/config/smri/scenarios.js` (330+ lines) - 20 scenarios
  - `getModuleCoverage()` (lines 251-284)
  - `getUntestedModules()` (lines 286-292)
  - `getComponentCoverage()` (lines 294-330)

### Development Scripts
- `scripts/check-consistency.cjs` (301 lines)
- `scripts/check-architecture.cjs` (313 lines)
  - SMRI modularity check (lines 250-294)
  - SMRI syntax validation (lines 296-344)
- `scripts/find-dead-facades.cjs` (139 lines)

### Documentation
- `src/components/README.md` - UI layer rules + SMRI integration
- `src/modules/README.md` - Business logic rules + facade pattern
- `scripts/README.md` - Complete dev tools reference
- `PROJECT-STATUS.md` - Centralized status

### Components
- `src/components/SplitScreenDemo.js` (384 lines)
  - Split-screen layout: left steps (400px) + right iframe (flex)
  - Methods: `init()`, `render()`, `next()`, `previous()`, `goTo()`
  - Auto-init via `data-split-demo` attribute
  - Example: `debug/demo-split-screen.html`

---

## ğŸ› Known Issues (Technical Debt)

### Dead Facade Methods (3 total)
1. `breeding/GeneticsEngine` - Doesn't exist (broken export)
2. `payment/PaymentConfig` - Unused
3. `payment/createPaymentAdapter` - Unused

### Untested Modules (2 total)
- S7: breeding (external genetics calculator)
- S9: tutorial (interactive tutorial system)

### Large Files (9 total)
- `worker/worker.js` (2153 lines) - Needs modularization
- `game-controller.js` (1210 lines) - Needs refactoring
- Others documented for v0.8.0

### Component Integration
- SplitScreenDemo created but not fully integrated
- 5/7 components unused in scenarios (29% coverage)

---

## ğŸ¯ Next Session Actions

### Quick Start
1. Run `.smri` to load full briefing (or read this file)
2. Check git log: `git log --oneline -20`
3. Check today's log: `.smri/logs/YYYY-MM-DD.md`

### Recommended Next Steps
1. **Integrate SplitScreenDemo** into more scenarios
2. **Create scenarios** for untested modules (breeding S7, tutorial S9)
3. **Fix or document** 3 dead facade methods
4. **Refactor large files** (worker.js, game-controller.js)

### If User Asks About Components
- Components are GENERIC (no S10+ numbers)
- Tracked via `component` field in scenarios
- Tested via integration (realistic approach)
- Run `npm run smri:list:components` for status

---

## ğŸ“‹ Session Commits (12 total)

Recent work (commits 1-12):
1. `7af5a4a` - Add dev tools (consistency + architecture)
2. `ec858ea` - Fix consistency issues
3. `8d6b417` - Finalize v0.7.7 (docs, workflows)
4. `b1d5859` - Add PROJECT-STATUS.md
5. `a1aaa61` - SMRI modularity checks
6. `b23c092` - Coverage tracking
7. `b4f9ca5` - Dead facade finder
8. `175522f` - SMRI command aliases
9. `0613f3e` - Update scripts README
10. `a5c3d46` - SplitScreenDemo component
11. `945c33d` - Components vs modules docs
12. `9d6c643` - UI component coverage tracking â­

---

## ğŸ’¡ Quick Reference

### Check Project Health
```bash
npm run dev:check          # Full check
npm test                   # Run all tests (14 tests)
git log --oneline -20      # Recent changes
```

### List Everything
```bash
npm run smri:list:scenarios   # All 20 scenarios
npm run smri:list:functions   # All 43 facade functions
npm run smri:list:components  # All 7 components
```

### Find Issues
```bash
npm run smri:dead            # Dead methods (3 found)
npm run smri:coverage        # Untested modules (2 found)
npm run dev:architecture     # Architecture violations
```

### Documentation
```bash
cat .smri/INDEX.md           # System rules (primary source)
cat PROJECT-STATUS.md        # Quick status
cat scripts/README.md        # Dev tools reference
ls .smri/logs/               # Session history
```

---

## ğŸ”„ Architecture Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Components     â”‚  Generic UI (Navigation, SplitScreen, modals)
â”‚   (Presentation) â”‚  NO SMRI numbers, tracked via scenarios
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ imports âœ…
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Modules      â”‚  Business Logic (S0-S9)
â”‚  (Business Layer)â”‚  Exported via index.js facades
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ imports
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Config      â”‚  Data (scenarios, species, constants)
â”‚   (Data Layer)   â”‚  Pure configuration
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Insight:** Components + Modules = Different purposes, both needed!

---

## ğŸ“ Lessons Learned

1. **Generic components don't need SMRI numbers** - Integration testing works better
2. **Facade pattern enforced via tooling** - Architecture checks prevent violations
3. **Coverage tracking bit-by-bit** - Focus testing where most necessary
4. **Session logs crucial** - Check git + logs before debugging from scratch

---

**Created:** 2026-01-13 17:00 UTC  
**Last Commit:** 9d6c643 (UI component coverage tracking)  
**Next Log:** `.smri/logs/2026-01-13-end-of-session.md` (if session continues)

**Ready for next AI agent! ğŸš€**
