<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üõí Customer Journey - Live Demo v0.7.7</title>
  <script src="../../src/utils/debug-loader.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0e14;
      color: #c9d1d9;
      overflow: hidden;
    }
    
    .demo-layout {
      display: grid;
      grid-template-columns: 350px 1fr;
      height: 100vh;
      gap: 0;
    }
    
    /* Left Panel - Controls */
    .control-panel {
      background: #161b22;
      border-right: 2px solid #30363d;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }
    
    .panel-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      color: white;
      flex-shrink: 0;
    }
    
    .panel-header h1 {
      font-size: 22px;
      margin-bottom: 8px;
    }
    
    .panel-header p {
      font-size: 13px;
      opacity: 0.9;
    }
    
    .pipeline-steps {
      padding: 20px;
      flex: 1;
    }
    
    .step {
      background: #0d1117;
      border: 2px solid #30363d;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .step:hover {
      border-color: #1f6feb;
      transform: translateX(5px);
    }
    
    .step.active {
      border-color: #1f6feb;
      background: linear-gradient(135deg, #1f6feb15, #0969da15);
    }
    
    .step.completed {
      border-color: #238636;
      background: linear-gradient(135deg, #23863615, #2ea04315);
    }
    
    .step-number {
      display: inline-block;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #21262d;
      color: #8b949e;
      text-align: center;
      line-height: 28px;
      font-weight: 600;
      font-size: 14px;
      margin-right: 10px;
    }
    
    .step.active .step-number {
      background: #1f6feb;
      color: white;
    }
    
    .step.completed .step-number {
      background: #238636;
      color: white;
    }
    
    .step-title {
      font-size: 15px;
      font-weight: 600;
      color: #c9d1d9;
      margin-bottom: 5px;
    }
    
    .step-desc {
      font-size: 12px;
      color: #8b949e;
      line-height: 1.4;
    }
    
    .action-buttons {
      padding: 15px 20px;
      border-top: 2px solid #30363d;
      display: flex;
      gap: 10px;
      flex-shrink: 0;
    }
    
    .btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: #238636;
      color: white;
    }
    
    .btn-primary:hover {
      background: #2ea043;
    }
    
    .btn-secondary {
      background: #21262d;
      color: #c9d1d9;
    }
    
    .btn-secondary:hover {
      background: #30363d;
    }
    
    /* Right Panel - Browser */
    .browser-panel {
      display: flex;
      flex-direction: column;
      background: #0d1117;
    }
    
    .browser-controls {
      background: #161b22;
      border-bottom: 2px solid #30363d;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }
    
    .browser-btn {
      background: #21262d;
      color: #c9d1d9;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }
    
    .browser-btn:hover {
      background: #30363d;
    }
    
    .url-bar {
      flex: 1;
      background: #0d1117;
      border: 1px solid #30363d;
      color: #58a6ff;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 13px;
      font-family: monospace;
    }
    
    .browser-content {
      flex: 1;
      position: relative;
      background: white;
    }
    
    .browser-content iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .status-overlay {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(35, 134, 54, 0.95);
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      font-size: 14px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      z-index: 1000;
      max-width: 300px;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .status-overlay.executing {
      background: rgba(245, 158, 11, 0.95);
    }
    
    .status-overlay.error {
      background: rgba(220, 38, 38, 0.95);
    }
    
    .log-panel {
      background: #0d1117;
      border-top: 2px solid #30363d;
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
      flex-shrink: 0;
    }
    
    .log-entry {
      padding: 4px 0;
      color: #8b949e;
    }
    
    .log-entry.success { color: #3fb950; }
    .log-entry.error { color: #f85149; }
    .log-entry.info { color: #58a6ff; }
  </style>
</head>
<body>
  <div class="demo-layout">
    <!-- Left Panel - Pipeline Steps -->
    <div class="control-panel">
      <div class="panel-header">
        <h1>üõí Customer Journey</h1>
        <p>Watch real user actions execute in browser</p>
      </div>
      
      <div class="pipeline-steps">
        <div class="step active" data-step="0" onclick="goToStep(0)">
          <div>
            <span class="step-number">1</span>
            <span class="step-title">Import Test Data</span>
          </div>
          <div class="step-desc">Upload 5 snakes to KV storage via import page</div>
        </div>
        
        <div class="step" data-step="1" onclick="goToStep(1)">
          <div>
            <span class="step-number">2</span>
            <span class="step-title">Browse Catalog</span>
          </div>
          <div class="step-desc">Customer views available snakes (filter by species)</div>
        </div>
        
        <div class="step" data-step="2" onclick="goToStep(2)">
          <div>
            <span class="step-number">3</span>
            <span class="step-title">Select Snake</span>
          </div>
          <div class="step-desc">Click "Pudding" - Banana Het Clown (‚Ç¨350)</div>
        </div>
        
        <div class="step" data-step="3" onclick="goToStep(3)">
          <div>
            <span class="step-number">4</span>
            <span class="step-title">Purchase Flow</span>
          </div>
          <div class="step-desc">Stripe Checkout ‚Üí Webhook ‚Üí KV Assignment</div>
        </div>
        
        <div class="step" data-step="4" onclick="goToStep(4)">
          <div>
            <span class="step-number">5</span>
            <span class="step-title">View Collection</span>
          </div>
          <div class="step-desc">Snake appears in game - ready to care!</div>
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-secondary" onclick="prevStep()">‚Üê Prev</button>
        <button class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
        <button class="btn btn-secondary" onclick="resetDemo()">üîÑ</button>
      </div>
    </div>
    
    <!-- Right Panel - Browser -->
    <div class="browser-panel">
      <div class="browser-controls">
        <button class="browser-btn" onclick="reloadPage()">üîÑ</button>
        <input type="text" class="url-bar" id="url-display" readonly value="">
        <button class="browser-btn" onclick="toggleLog()">üìã Logs</button>
      </div>
      
      <div class="browser-content">
        <iframe id="demo-iframe" src=""></iframe>
        <div class="status-overlay" id="status-overlay" style="display: none;">
          <div id="status-text">Ready</div>
        </div>
      </div>
      
      <div class="log-panel" id="log-panel" style="display: none;">
        <div id="log-entries">
          <div class="log-entry info">üìä Demo initialized - Ready to execute</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentStep = 0;
    const baseUrl = window.location.origin;
    
    const steps = [
      {
        url: `${baseUrl}/import.html`,
        title: 'Import Test Data',
        action: async () => {
          showStatus('üì§ Loading import page...', 'executing');
          await wait(1000);
          log('‚úÖ Import page loaded', 'success');
          log('üìù In real demo: paste JSON with 5 test snakes', 'info');
          showStatus('‚úÖ Ready to import data\n\nPaste JSON and click Import', 'success');
        }
      },
      {
        url: `${baseUrl}/catalog.html`,
        title: 'Browse Catalog',
        action: async () => {
          showStatus('üõí Loading catalog...', 'executing');
          await wait(1000);
          log('‚úÖ Catalog loaded with products', 'success');
          log('üëÄ Customer browsing 5 available snakes', 'info');
          showStatus('‚úÖ Catalog loaded!\n\n5 snakes available to purchase', 'success');
        }
      },
      {
        url: `${baseUrl}/catalog.html#real-bp-001`,
        title: 'Select Snake',
        action: async () => {
          showStatus('üêç Opening product details...', 'executing');
          await wait(1000);
          log('‚úÖ Product page loaded: Pudding (Banana Het Clown)', 'success');
          log('üí∞ Price: ‚Ç¨350', 'info');
          showStatus('‚úÖ Viewing: Pudding\n\nBanana Het Clown - ‚Ç¨350\n\nReady to purchase!', 'success');
        }
      },
      {
        url: `${baseUrl}/success.html`,
        title: 'Purchase Complete',
        action: async () => {
          showStatus('üí≥ Processing payment...', 'executing');
          await wait(1500);
          log('‚úÖ Stripe payment successful', 'success');
          log('üîó Webhook received by Worker', 'info');
          await wait(800);
          log('üì¶ Product assigned to user in KV', 'success');
          log('üìß Email sent via Resend', 'info');
          showStatus('‚úÖ Purchase Complete!\n\nSnake assigned to your collection', 'success');
        }
      },
      {
        url: `${baseUrl}/game.html`,
        title: 'View Collection',
        action: async () => {
          showStatus('üéÆ Loading game...', 'executing');
          await wait(1000);
          log('‚úÖ Game loaded - fetching user products', 'success');
          await wait(500);
          log('üêç Snake appears in collection!', 'success');
          log('üéØ Ready to feed, water, and clean', 'info');
          showStatus('‚úÖ Demo Complete!\n\nYour snake is ready to care for üêç', 'success');
        }
      }
    ];
    
    function goToStep(stepIndex) {
      if (stepIndex < 0 || stepIndex >= steps.length) return;
      
      currentStep = stepIndex;
      
      // Update step indicators
      document.querySelectorAll('.step').forEach((el, i) => {
        el.classList.remove('active', 'completed');
        if (i === stepIndex) el.classList.add('active');
        if (i < stepIndex) el.classList.add('completed');
      });
      
      // Load page and execute action
      const step = steps[stepIndex];
      const iframe = document.getElementById('demo-iframe');
      const urlDisplay = document.getElementById('url-display');
      
      iframe.src = step.url;
      urlDisplay.value = step.url;
      
      log(`üîÑ Step ${stepIndex + 1}: ${step.title}`, 'info');
      
      // Execute step action after iframe loads
      iframe.onload = () => {
        setTimeout(() => {
          step.action();
        }, 300);
      };
    }
    
    function nextStep() {
      if (currentStep < steps.length - 1) {
        goToStep(currentStep + 1);
      }
    }
    
    function prevStep() {
      if (currentStep > 0) {
        goToStep(currentStep - 1);
      }
    }
    
    function resetDemo() {
      currentStep = -1;
      document.getElementById('log-entries').innerHTML = '<div class="log-entry info">üìä Demo reset - Starting from beginning</div>';
      goToStep(0);
    }
    
    function reloadPage() {
      const iframe = document.getElementById('demo-iframe');
      iframe.src = iframe.src;
      log('üîÑ Page reloaded', 'info');
    }
    
    function toggleLog() {
      const logPanel = document.getElementById('log-panel');
      logPanel.style.display = logPanel.style.display === 'none' ? 'block' : 'none';
    }
    
    function showStatus(message, type = 'success') {
      const overlay = document.getElementById('status-overlay');
      const text = document.getElementById('status-text');
      
      overlay.className = 'status-overlay ' + type;
      text.textContent = message;
      overlay.style.display = 'block';
    }
    
    function log(message, type = 'info') {
      const logEntries = document.getElementById('log-entries');
      const entry = document.createElement('div');
      entry.className = 'log-entry ' + type;
      const time = new Date().toLocaleTimeString();
      entry.textContent = `[${time}] ${message}`;
      logEntries.appendChild(entry);
      logEntries.scrollTop = logEntries.scrollHeight;
    }
    
    function wait(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // Initialize
    goToStep(0);
  </script>
</body>
</html>
