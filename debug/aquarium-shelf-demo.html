<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üêç Aquarium Shelves</title>
  <script src="../src/utils/debug-loader.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .shelf-info {
      color: rgba(255,255,255,0.9);
      font-size: 16px;
      margin-top: 10px;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      background: white;
      color: #667eea;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: all 0.3s;
      font-size: 14px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    
    /* Shelf Container */
    .shelf-container {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
    }
    
    .shelf-wrapper {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    
    .shelf-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      color: white;
    }
    
    .shelf-title {
      font-size: 24px;
      font-weight: bold;
    }
    
    .shelf-actions {
      display: flex;
      gap: 10px;
    }
    
    .action-btn {
      padding: 8px 16px;
      background: rgba(255,255,255,0.9);
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      color: #667eea;
      font-size: 13px;
      transition: all 0.2s;
    }
    
    .action-btn:hover {
      background: white;
      transform: scale(1.05);
    }
    
    /* Aquarium Grid - 10 per shelf (2 rows x 5 cols) */
    .aquarium-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .aquarium {
      background: linear-gradient(180deg, #e3f2fd 0%, #bbdefb 100%);
      border: 3px solid #1976d2;
      border-radius: 15px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      position: relative;
      overflow: hidden;
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .aquarium:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      border-color: #0d47a1;
    }
    
    .aquarium::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, 
        rgba(255,255,255,0.3) 0%, 
        rgba(255,255,255,0) 50%, 
        rgba(0,0,0,0.1) 100%);
      pointer-events: none;
    }
    
    .aquarium-number {
      position: absolute;
      top: 8px;
      left: 8px;
      background: rgba(255,255,255,0.9);
      color: #1976d2;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      z-index: 1;
    }
    
    .snake-emoji {
      font-size: 48px;
      margin-bottom: 8px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
      z-index: 1;
    }
    
    .snake-name {
      font-size: 14px;
      font-weight: bold;
      color: #0d47a1;
      text-align: center;
      text-shadow: 0 1px 2px rgba(255,255,255,0.8);
      z-index: 1;
    }
    
    .aquarium-empty {
      opacity: 0.5;
      background: linear-gradient(180deg, #f5f5f5 0%, #e0e0e0 100%);
      border-color: #bdbdbd;
    }
    
    .aquarium-empty .snake-emoji {
      font-size: 36px;
      opacity: 0.3;
    }
    
    /* Shelf Navigation */
    .shelf-nav {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-top: 20px;
    }
    
    .nav-btn {
      width: 50px;
      height: 50px;
      background: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: all 0.3s;
      color: #667eea;
      font-weight: bold;
    }
    
    .nav-btn:hover:not(:disabled) {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    
    .nav-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    
    .shelf-indicator {
      color: white;
      font-size: 18px;
      font-weight: bold;
      min-width: 150px;
      text-align: center;
    }
    
    @media (max-width: 1024px) {
      .aquarium-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (max-width: 640px) {
      .aquarium-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .aquarium {
        padding: 10px;
      }
      
      .snake-emoji {
        font-size: 32px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üêç Aquarium Shelves</h1>
    <div class="shelf-info" id="shelf-info">Loading...</div>
  </div>
  
  <div class="controls">
    <button class="btn" onclick="loadScenario(5)">5 Snakes</button>
    <button class="btn" onclick="loadScenario(10)">10 Snakes (1 Shelf)</button>
    <button class="btn" onclick="loadScenario(25)">25 Snakes (3 Shelves)</button>
    <button class="btn" onclick="loadMixedStates()">Mixed States</button>
  </div>
  
  <div class="shelf-container">
    <div class="shelf-wrapper">
      <div class="shelf-header">
        <div class="shelf-title" id="shelf-title">Shelf 1</div>
        <div class="shelf-actions">
          <button class="action-btn" onclick="cleanAll()">üßπ Clean All</button>
          <button class="action-btn" onclick="feedAll()">üçñ Feed All</button>
        </div>
      </div>
      
      <div class="aquarium-grid" id="aquarium-grid"></div>
      
      <div class="shelf-nav">
        <button class="nav-btn" id="prev-btn" onclick="prevShelf()">‚Äπ</button>
        <div class="shelf-indicator" id="shelf-indicator">Shelf 1 of 1</div>
        <button class="nav-btn" id="next-btn" onclick="nextShelf()">‚Ä∫</button>
      </div>
    </div>
  </div>
  
  <script type="module">
    import { ShelfManager } from '../src/modules/game/shelf-manager.js?v=4';
    import { SnakeDetailView } from '../src/modules/game/snake-detail-view.js?v=4';
    
    console.log('üöÄ Initializing Aquarium Shelves...');
    
    window.gameState = { snakes: [], currency: { gold: 5000 } };
    window.shelfManager = null;
    
    function renderShelves() {
      if (!window.shelfManager) {
        console.log('‚ö†Ô∏è No shelf manager');
        return;
      }
      
      const currentSnakes = window.shelfManager.getCurrentShelfSnakes();
      const grid = document.getElementById('aquarium-grid');
      
      // Always show 10 aquarium slots per shelf
      const slots = Array(10).fill(null).map((_, i) => currentSnakes[i] || null);
      
      grid.innerHTML = slots.map((snake, index) => {
        if (!snake) {
          return `
            <div class="aquarium aquarium-empty">
              <div class="aquarium-number">${index + 1}</div>
              <div class="snake-emoji">üè†</div>
              <div class="snake-name">Empty</div>
            </div>
          `;
        }
        
        const state = getSnakeState(snake);
        return `
          <div class="aquarium" onclick="openSnakeDetail('${snake.id}')">
            <div class="aquarium-number">${index + 1}</div>
            <div class="snake-emoji">${state.emoji}</div>
            <div class="snake-name">${snake.nickname}</div>
          </div>
        `;
      }).join('');
      
      // Update shelf info
      const currentShelf = window.shelfManager.currentShelfIndex + 1;
      const totalShelves = window.shelfManager.totalShelves;
      const totalSnakes = window.shelfManager.totalSnakes;
      
      document.getElementById('shelf-title').textContent = `Shelf ${currentShelf}`;
      document.getElementById('shelf-indicator').textContent = `Shelf ${currentShelf} of ${totalShelves}`;
      document.getElementById('shelf-info').textContent = 
        `${totalSnakes} snakes across ${totalShelves} shelf${totalShelves !== 1 ? 'es' : ''}`;
      
      // Update nav buttons
      document.getElementById('prev-btn').disabled = currentShelf === 1;
      document.getElementById('next-btn').disabled = currentShelf === totalShelves;
      
      console.log(`‚úÖ Rendered shelf ${currentShelf}/${totalShelves} with ${currentSnakes.length} snakes`);
    }
    
    function getSnakeState(snake) {
      if (snake.stats.health < 30) return { emoji: 'ü§¢', state: 'sick' };
      if (snake.shed_cycle?.stage === 'blue') return { emoji: 'üîµ', state: 'shedding' };
      if (snake.stats.hunger < 30) return { emoji: 'üòã', state: 'hungry' };
      if (snake.stats.happiness > 80) return { emoji: 'üòä', state: 'happy' };
      if (snake.stats.stress > 70) return { emoji: 'üò∞', state: 'stressed' };
      return { emoji: 'üêç', state: 'normal' };
    }
    
    window.openSnakeDetail = function(snakeId) {
      const snake = window.gameState.snakes.find(s => s.id === snakeId);
      if (snake) {
        console.log(`üëÅÔ∏è Opening details for: ${snake.nickname}`);
        new SnakeDetailView(snake, window.gameState).open();
      }
    };
    
    window.nextShelf = function() {
      if (window.shelfManager) {
        window.shelfManager.nextShelf();
        renderShelves();
        console.log('‚û°Ô∏è Next shelf');
      }
    };
    
    window.prevShelf = function() {
      if (window.shelfManager) {
        window.shelfManager.previousShelf();
        renderShelves();
        console.log('‚¨ÖÔ∏è Previous shelf');
      }
    };
    
    window.cleanAll = function() {
      if (window.shelfManager) {
        const count = window.shelfManager.cleanAllOnCurrentShelf();
        renderShelves();
        console.log(`‚úÖ Cleaned ${count} aquariums!`);
      }
    };
    
    window.feedAll = function() {
      const snakes = window.shelfManager.getCurrentShelfSnakes();
      snakes.forEach(s => s.stats.hunger = 100);
      renderShelves();
      console.log(`‚úÖ Fed ${snakes.length} snakes!`);
    };
    
    function createTestSnake(index, overrides = {}) {
      return {
        id: `snake-${index}`,
        nickname: `${['Slinky', 'Noodle', 'Monty', 'Luna', 'Pixel', 'Shadow', 'Basil', 'Olive', 'Pepper', 'Sage'][index % 10]} #${index}`,
        type: 'real',
        species: 'ball_python',
        morph: ['Banana', 'Piebald', 'Pastel', 'Albino', 'Mojave', 'Cinnamon'][index % 6],
        sex: index % 2 === 0 ? 'male' : 'female',
        weight_grams: 100 + (index * 10),
        length_cm: 30 + (index * 2),
        stats: {
          hunger: Math.max(20, 80 - (index * 2)),
          water: 100,
          temperature: 80,
          humidity: 60,
          health: Math.max(30, 100 - (index * 1.5)),
          stress: Math.min(80, 10 + (index * 2)),
          cleanliness: Math.max(30, 100 - (index * 3)),
          happiness: Math.max(40, 85 - (index * 1.5)),
          ...overrides.stats
        },
        equipment: { enclosure_tier: Math.min(5, Math.floor(index / 5) + 1) },
        shed_cycle: { stage: 'normal', days_since_last: 5 },
        last_fed: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
        last_cleaned: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()
      };
    }
    
    window.loadScenario = function(count) {
      console.log(`üîÑ Loading ${count} snakes...`);
      window.gameState.snakes = [];
      for (let i = 1; i <= count; i++) {
        window.gameState.snakes.push(createTestSnake(i));
      }
      
      window.shelfManager = new ShelfManager(window.gameState);
      window.shelfManager.currentShelfIndex = 0;
      renderShelves();
      console.log(`‚úÖ Loaded ${count} snakes across ${window.shelfManager.totalShelves} shelves`);
    };
    
    window.loadMixedStates = function() {
      console.log('üîÑ Loading mixed states...');
      window.gameState.snakes = [
        createTestSnake(1, { stats: { hunger: 25 } }),
        createTestSnake(2, { stats: { health: 20 } }),
        createTestSnake(3, { stats: { happiness: 95 } }),
        createTestSnake(4, { stats: { stress: 85 } }),
        createTestSnake(5, { shed_cycle: { stage: 'blue' } }),
        createTestSnake(6)
      ];
      
      window.shelfManager = new ShelfManager(window.gameState);
      window.shelfManager.currentShelfIndex = 0;
      renderShelves();
      console.log('‚úÖ Mixed states loaded');
    };
    
    // Initialize
    console.log('‚úÖ Aquarium Shelves initialized');
    loadScenario(10);
  </script>
</body>
</html>
