<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ§ª Aquarium Shelf - Debug Demo</title>
  <script src="../src/utils/debug-loader.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 { color: #333; }
    .controls {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .btn {
      padding: 10px 20px;
      margin-right: 10px;
      margin-bottom: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      background: #667eea;
      color: white;
    }
    .btn:hover { background: #5568d3; }
    .btn-secondary { background: #48bb78; }
    .btn-secondary:hover { background: #38a169; }
    .info {
      background: #e6f7ff;
      padding: 15px;
      border-radius: 6px;
      border-left: 4px solid #1890ff;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª Aquarium Shelf System - Debug Demo</h1>
  
  <div class="info">
    <strong>Debug Console Active!</strong> Look for the green ğŸ“‹ button in bottom-right corner.
    <br>Click it to see real-time logs and debug info.
  </div>
  
  <div class="controls">
    <h2>Test Scenarios</h2>
    <button class="btn" onclick="loadScenario(5)">Load 5 Snakes</button>
    <button class="btn" onclick="loadScenario(10)">Load 10 Snakes</button>
    <button class="btn" onclick="loadScenario(25)">Load 25 Snakes</button>
    <button class="btn btn-secondary" onclick="loadMixedStates()">Load Mixed States</button>
    <button class="btn btn-secondary" onclick="runTests()">Run Tests</button>
  </div>
  
  <div id="aquarium-shelf-container"></div>
  
  <script type="module">
    import { ShelfManager } from '../src/modules/game/shelf-manager.js?v=2';
    import { SnakeDetailView } from '../src/modules/game/snake-detail-view.js?v=2';
    
    console.log('ğŸš€ Initializing Aquarium Shelf Demo...');
    
    window.shelfManager = null;
    window.gameState = { snakes: [], currency: { gold: 5000 } };
    
    // Create test snake
    function createTestSnake(index, overrides = {}) {
      return {
        id: `snake-${index}`,
        nickname: `Snake ${index}`,
        type: 'real',
        species: 'ball_python',
        morph: ['Banana', 'Piebald', 'Pastel', 'Albino'][index % 4],
        sex: index % 2 === 0 ? 'male' : 'female',
        weight_grams: 100 + (index * 10),
        length_cm: 30 + (index * 2),
        stats: {
          hunger: 80,
          water: 100,
          temperature: 80,
          humidity: 60,
          health: 100,
          stress: 10,
          cleanliness: 100,
          happiness: 85,
          ...overrides.stats
        },
        equipment: { enclosure_tier: Math.min(5, Math.floor(index / 5) + 1) },
        shed_cycle: { stage: 'normal', days_since_last: 5 },
        last_fed: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
        last_cleaned: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()
      };
    }
    
    // Render shelf
    function renderShelf() {
      try {
        console.log(`ğŸ”„ Rendering shelf with ${window.gameState.snakes.length} snakes...`);
        const container = document.getElementById('aquarium-shelf-container');
        window.shelfManager = new ShelfManager(window.gameState);
        
        console.log(`ğŸ“Š Shelf Manager created:`, {
          type: window.shelfManager.type,
          totalSnakes: window.shelfManager.totalSnakes,
          filteredSnakes: window.shelfManager.filteredSnakes.length,
          totalShelves: window.shelfManager.totalShelves
        });
        
        window.shelfManager.onCleanAll = (count) => {
          console.log(`âœ… Cleaned ${count} aquarium(s)!`);
        };
        
        window.shelfManager.onAquariumClick = (snakeId) => {
          const snake = window.gameState.snakes.find(s => s.id === snakeId);
          if (snake) {
            console.log(`ğŸ‘ï¸ Opening details for: ${snake.nickname}`);
            new SnakeDetailView(snake, window.gameState).open();
          }
        };
        
        window.shelfManager.render(container);
        console.log('âœ… Shelf rendered successfully');
      } catch (e) {
        console.error('âŒ Render error:', e.message);
        console.error(e);
      }
    }
    
    // Load scenario
    window.loadScenario = function(count) {
      try {
        console.log(`ğŸ”„ Loading ${count} snakes...`);
        window.gameState.snakes = [];
        for (let i = 1; i <= count; i++) {
          window.gameState.snakes.push(createTestSnake(i));
        }
        console.log(`âœ… Created ${count} snake objects`);
        renderShelf();
      } catch (e) {
        console.error('âŒ Load scenario error:', e.message);
        console.error(e);
      }
    };
    
    // Load mixed states
    window.loadMixedStates = function() {
      try {
        console.log('ğŸ”„ Loading mixed states...');
        window.gameState.snakes = [
          createTestSnake(1, { stats: { hunger: 25 } }),
          createTestSnake(2, { stats: { health: 20 } }),
          createTestSnake(3, { stats: { happiness: 95 } }),
          createTestSnake(4, { stats: { stress: 85 } }),
          createTestSnake(5, { shed_cycle: { stage: 'blue' } }),
          createTestSnake(6)
        ];
        console.log('âœ… Mixed states created:', window.gameState.snakes.map(s => ({
          id: s.id,
          hunger: s.stats.hunger,
          health: s.stats.health
        })));
        renderShelf();
      } catch (e) {
        console.error('âŒ Mixed states error:', e.message);
        console.error(e);
      }
    };
    
    // Run tests
    window.runTests = function() {
      try {
        console.log('ğŸ§ª Running automated tests...');
        
        console.log('Test 1: Loading 10 snakes...');
        loadScenario(10);
        const test1 = window.shelfManager.totalSnakes === 10;
        console.log(test1 ? 'âœ… Test 1 PASSED: 10 snakes loaded' : 'âŒ Test 1 FAILED');
        
        console.log('Test 2: Shelf navigation...');
        const initialShelf = window.shelfManager.currentShelfIndex;
        window.shelfManager.nextShelf();
        window.shelfManager.previousShelf();
        const test2 = window.shelfManager.currentShelfIndex === initialShelf;
        console.log(test2 ? 'âœ… Test 2 PASSED: Navigation works' : 'âŒ Test 2 FAILED');
        
        console.log('Test 3: Loading 25 snakes (3 shelves)...');
        loadScenario(25);
        const test3 = window.shelfManager.totalShelves === 3;
        console.log(test3 ? 'âœ… Test 3 PASSED: 3 shelves created' : 'âŒ Test 3 FAILED');
        
        console.log('ğŸ‰ All tests completed!');
      } catch (e) {
        console.error('âŒ Test failed:', e.message);
        console.error(e);
      }
    };
    
    // Initialize
    console.log('âœ… Modules loaded successfully');
    console.log('ğŸš€ Auto-loading 10 snakes for demo...');
    loadScenario(10);
  </script>
</body>
</html>
