<!DOCTYPE html>
<html>
<head>
  <title>Snake Debug</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    .log { background: #000; color: #0f0; padding: 10px; margin: 10px 0; }
    .error { color: #f00; }
    .success { color: #0f0; }
  </style>
</head>
<body>
  <h1>ğŸ Snake Loading Debug</h1>
  <div id="log"></div>
  
  <script type="module">
    const log = document.getElementById('log');
    
    function addLog(msg, isError = false) {
      const div = document.createElement('div');
      div.className = 'log ' + (isError ? 'error' : 'success');
      div.textContent = msg;
      log.appendChild(div);
      console.log(msg);
    }
    
    async function test() {
      try {
        // Get user from URL
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user') || 'b2c6456eb79a';
        
        addLog('ğŸ”‘ User ID: ' + userId);
        addLog('ğŸ“¡ Fetching user products...');
        
        const response = await fetch('https://catalog.navickaszilvinas.workers.dev/user-products?user=' + userId);
        const data = await response.json();
        
        addLog('âœ… Got response: ' + data.length + ' products');
        
        if (data.length === 0) {
          addLog('âŒ NO PRODUCTS FOUND!', true);
          return;
        }
        
        addLog('ğŸ”„ Converting to snakes...');
        
        const snakes = data.map((up, i) => ({
          id: up.assignment_id || up.product_id,
          nickname: up.nickname || 'Snake ' + (i+1),
          species: up.species || 'ball_python',
          morph: up.morph || 'normal',
          stats: up.stats
        }));
        
        addLog('âœ… Converted: ' + snakes.length + ' snakes');
        
        snakes.forEach((s, i) => {
          addLog(`  ${i+1}. ${s.nickname} - ${s.species}/${s.morph}`);
        });
        
        addLog('ğŸ‰ ALL WORKING! Snakes should display in game.html');
        
      } catch (error) {
        addLog('âŒ ERROR: ' + error.message, true);
        addLog('Stack: ' + error.stack, true);
      }
    }
    
    test();
  </script>
</body>
</html>
