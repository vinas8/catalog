<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üêç Tutorial Collection Runner - Snake Muffin</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0e14;
      color: #c9d1d9;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 { color: #58a6ff; margin-bottom: 10px; font-size: 24px; }
    
    .subtitle {
      color: #8b949e;
      margin-bottom: 20px;
      font-size: 13px;
    }
    
    .btn {
      background: #238636;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }
    
    .btn:hover { background: #2ea043; }
    .btn:disabled { background: #21262d; cursor: not-allowed; opacity: 0.5; }
    
    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
    }
    
    .test-card {
      background: #161b22;
      border: 2px solid #30363d;
      border-radius: 8px;
      margin-bottom: 12px;
      overflow: hidden;
      transition: border-color 0.3s;
    }
    
    .test-card.running { border-color: #d29922; }
    .test-card.passed { border-color: #3fb950; }
    .test-card.failed { border-color: #f85149; }
    
    .test-header {
      padding: 14px 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      user-select: none;
    }
    
    .test-header:hover { background: #1c2128; }
    
    .test-number {
      background: #21262d;
      color: #8b949e;
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      min-width: 50px;
      text-align: center;
    }
    
    .test-title { 
      flex: 1; 
      font-weight: 500;
      font-size: 14px;
    }
    
    .test-duration {
      background: #21262d;
      color: #8b949e;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
    }
    
    .test-status {
      font-size: 20px;
      min-width: 30px;
      text-align: center;
    }
    
    .test-body {
      display: none;
      padding: 16px;
      border-top: 1px solid #30363d;
      background: #0d1117;
    }
    
    .test-body.show { display: block; }
    
    .test-section {
      margin-bottom: 16px;
    }
    
    .test-section h4 {
      color: #8b949e;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    
    .code-block {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 12px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      overflow-x: auto;
      line-height: 1.5;
      color: #c9d1d9;
    }
    
    .progress-bar {
      background: #161b22;
      border-radius: 10px;
      height: 28px;
      overflow: hidden;
      margin: 15px 0;
      border: 2px solid #30363d;
      display: none;
    }
    
    .progress-fill {
      background: linear-gradient(90deg, #238636, #2ea043);
      height: 100%;
      width: 0%;
      transition: width 0.3s ease-out;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 13px;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    
    .progress-text {
      color: #58a6ff;
      font-size: 13px;
      font-weight: bold;
      margin-top: 10px;
      display: none;
    }
    
    .run-btn-container {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 20px;
    }

    .iframe-container {
      width: 100%;
      height: 600px;
      border: 2px solid #30363d;
      border-radius: 8px;
      background: #0a0e14;
      margin-top: 12px;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 6px;
    }

    .summary-box {
      background: #161b22;
      border: 2px solid #30363d;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 12px;
    }

    .summary-item {
      text-align: center;
    }

    .summary-value {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .summary-label {
      color: #8b949e;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
  </style>
</head>
<body>
  <h1>üêç Tutorial Collection Runner (S2-7.x)</h1>
  <p class="subtitle">
    <strong>Collection ID:</strong> COL-S2-7-tutorial | 
    <strong>Module:</strong> S2 (Game) | 
    <strong>Scenarios:</strong> 6 | 
    <strong>Duration:</strong> ~5-6 minutes<br>
    <span style="display: inline-flex; align-items: center; gap: 8px; margin-top: 5px;">
      <strong style="color: #8b949e;">Tests:</strong>
      <span style="background: #f77f00; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px;">Care Mechanics</span>
      <span style="background: #1f6feb; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px;">Event System</span>
      <span style="background: #8957e5; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px;">LocalStorage</span>
    </span><br>
    <a href="index.html" style="color: #58a6ff; text-decoration: none; font-size: 12px;">‚Üê Back to Debug Hub</a>
  </p>
  
  <div class="summary-box">
    <h2 style="color: #c9d1d9; font-size: 16px; margin-bottom: 10px;">Collection Summary</h2>
    <div class="summary-grid">
      <div class="summary-item">
        <div class="summary-value" style="color: #58a6ff;" id="total-count">6</div>
        <div class="summary-label">Total</div>
      </div>
      <div class="summary-item">
        <div class="summary-value" style="color: #3fb950;" id="passed-count">0</div>
        <div class="summary-label">Passed</div>
      </div>
      <div class="summary-item">
        <div class="summary-value" style="color: #f85149;" id="failed-count">0</div>
        <div class="summary-label">Failed</div>
      </div>
      <div class="summary-item">
        <div class="summary-value" style="color: #8b949e;" id="pending-count">6</div>
        <div class="summary-label">Pending</div>
      </div>
    </div>
  </div>

  <div class="run-btn-container">
    <button onclick="runAllScenarios()" class="btn" id="run-all-btn">‚ñ∂ Run All Scenarios</button>
    <button onclick="collapseAll()" class="btn btn-small">Collapse All</button>
    <button onclick="expandAll()" class="btn btn-small">Expand All</button>
    <button onclick="resetAll()" class="btn btn-small" style="background: #d29922;">‚Üª Reset</button>
  </div>
  
  <div class="progress-bar" id="progress-container">
    <div class="progress-fill" id="progress-bar">0%</div>
  </div>
  <div class="progress-text" id="progress-text">Ready to run</div>
  
  <div id="scenario-list"></div>

  <script>
    const scenarios = [
      {
        id: 'S2-7.x.01',
        name: 'Happy Path (Daily Check-in)',
        url: 'tutorial-happy-path.html',
        duration: '<60s',
        description: 'Tests daily care routine, positive reinforcement, and basic mechanics',
        tests: ['Feed action', 'Water action', 'Stat display', 'Event timers']
      },
      {
        id: 'S2-7.x.02',
        name: 'Missed Care (2-3 days)',
        url: 'tutorial-missed-care.html',
        duration: '<60s',
        description: 'Tests stat decay over time, recovery mechanics, re-engagement flow',
        tests: ['Decay rates', 'Critical warnings', 'Recovery actions', 'Stat persistence']
      },
      {
        id: 'S2-7.x.03',
        name: 'Education-First Commerce',
        url: 'tutorial-education-commerce.html',
        duration: '<60s',
        description: 'Browse catalog without purchase pressure, learn before buying',
        tests: ['Catalog access', 'No forced purchase', 'Educational content', 'Trust building']
      },
      {
        id: 'S2-7.x.04',
        name: 'Trust Protection',
        url: 'tutorial-trust-protection.html',
        duration: '<60s',
        description: 'Transparent care requirements, no dark patterns, honest expectations',
        tests: ['Clear requirements', 'No manipulation', 'Transparent costs', 'Exit options']
      },
      {
        id: 'S2-7.x.05',
        name: 'Email-Driven Re-entry',
        url: 'tutorial-email-reentry.html',
        duration: '<60s',
        description: 'Email notification triggers, multi-day gap handling, return flow',
        tests: ['Email triggers', 'State recovery', 'Gap handling', 'Re-engagement']
      },
      {
        id: 'S2-7.x.06',
        name: 'Failure Case (Educational)',
        url: 'tutorial-failure-educational.html',
        duration: '<60s',
        description: 'Death scenario, educational failure messages, learning opportunity',
        tests: ['Death trigger', 'Educational message', 'Restart option', 'Lesson learned']
      }
    ];

    let currentScenarioIndex = -1;
    let results = { passed: 0, failed: 0, pending: 6 };

    function renderScenarios() {
      const list = document.getElementById('scenario-list');
      list.innerHTML = scenarios.map((scenario, index) => `
        <div class="test-card" id="scenario-${index}">
          <div class="test-header" onclick="toggleScenario(${index})">
            <div class="test-number">${scenario.id}</div>
            <div class="test-title">${scenario.name}</div>
            <div class="test-duration">${scenario.duration}</div>
            <div class="test-status" id="status-${index}">‚è≥</div>
          </div>
          <div class="test-body" id="body-${index}">
            <div class="test-section">
              <h4>Description</h4>
              <p style="color: #8b949e; font-size: 13px; line-height: 1.6;">${scenario.description}</p>
            </div>
            <div class="test-section">
              <h4>Tests Performed</h4>
              <ul style="color: #8b949e; font-size: 12px; line-height: 1.8; padding-left: 20px;">
                ${scenario.tests.map(test => `<li>${test}</li>`).join('')}
              </ul>
            </div>
            <div class="test-section">
              <h4>URL</h4>
              <div class="code-block">${scenario.url}</div>
            </div>
            <div class="test-section">
              <button onclick="runSingleScenario(${index})" class="btn btn-small">‚ñ∂ Run This Scenario</button>
              <button onclick="openInNewTab(${index})" class="btn btn-small" style="background: #1f6feb;">‚Üó Open in New Tab</button>
            </div>
            <div class="iframe-container" id="iframe-${index}" style="display: none;">
              <iframe id="frame-${index}" src="about:blank"></iframe>
            </div>
          </div>
        </div>
      `).join('');
    }

    function toggleScenario(index) {
      const body = document.getElementById(`body-${index}`);
      body.classList.toggle('show');
    }

    function collapseAll() {
      scenarios.forEach((_, index) => {
        document.getElementById(`body-${index}`).classList.remove('show');
      });
    }

    function expandAll() {
      scenarios.forEach((_, index) => {
        document.getElementById(`body-${index}`).classList.add('show');
      });
    }

    function openInNewTab(index) {
      window.open(scenarios[index].url, '_blank');
    }

    async function runSingleScenario(index) {
      const scenario = scenarios[index];
      const card = document.getElementById(`scenario-${index}`);
      const status = document.getElementById(`status-${index}`);
      const iframeContainer = document.getElementById(`iframe-${index}`);
      const iframe = document.getElementById(`frame-${index}`);
      const body = document.getElementById(`body-${index}`);

      // Show body and iframe
      body.classList.add('show');
      iframeContainer.style.display = 'block';

      // Update status
      card.className = 'test-card running';
      status.textContent = 'üîÑ';

      try {
        // Load scenario in iframe
        iframe.src = scenario.url;

        // Wait for load
        await new Promise((resolve) => {
          iframe.onload = () => {
            setTimeout(resolve, 2000); // Give it 2s to initialize
          };
        });

        // Check if loaded successfully
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        if (iframeDoc.body.textContent.includes('Error') || iframeDoc.body.textContent.length < 100) {
          throw new Error('Scenario failed to load properly');
        }

        // Mark as passed
        card.className = 'test-card passed';
        status.textContent = '‚úÖ';
        results.passed++;
        results.pending--;
        updateSummary();

      } catch (error) {
        card.className = 'test-card failed';
        status.textContent = '‚ùå';
        results.failed++;
        results.pending--;
        updateSummary();
        console.error(`Scenario ${scenario.id} failed:`, error);
      }
    }

    async function runAllScenarios() {
      const runBtn = document.getElementById('run-all-btn');
      const progressContainer = document.getElementById('progress-container');
      const progressBar = document.getElementById('progress-bar');
      const progressText = document.getElementById('progress-text');

      // Disable button and show progress
      runBtn.disabled = true;
      progressContainer.style.display = 'block';
      progressText.style.display = 'block';

      // Reset results
      results = { passed: 0, failed: 0, pending: 6 };
      updateSummary();

      for (let i = 0; i < scenarios.length; i++) {
        currentScenarioIndex = i;
        const progress = Math.round(((i + 1) / scenarios.length) * 100);
        progressBar.style.width = `${progress}%`;
        progressBar.textContent = `${progress}% (${i + 1}/${scenarios.length})`;
        progressText.textContent = `Running: ${scenarios[i].name}`;

        await runSingleScenario(i);
        
        // Wait 1s between scenarios
        if (i < scenarios.length - 1) {
          await new Promise(resolve => setTimeout(resolve, 1000));
        }
      }

      // Complete
      progressText.textContent = `‚úÖ Complete! ${results.passed} passed, ${results.failed} failed`;
      runBtn.disabled = false;

      // Show summary alert
      const allPassed = results.failed === 0;
      setTimeout(() => {
        alert(allPassed 
          ? `‚úÖ All ${scenarios.length} scenarios passed!` 
          : `‚ö†Ô∏è ${results.passed}/${scenarios.length} passed, ${results.failed} failed`
        );
      }, 500);
    }

    function updateSummary() {
      document.getElementById('passed-count').textContent = results.passed;
      document.getElementById('failed-count').textContent = results.failed;
      document.getElementById('pending-count').textContent = results.pending;
    }

    function resetAll() {
      // Reset all cards
      scenarios.forEach((_, index) => {
        const card = document.getElementById(`scenario-${index}`);
        const status = document.getElementById(`status-${index}`);
        const iframeContainer = document.getElementById(`iframe-${index}`);
        const body = document.getElementById(`body-${index}`);

        card.className = 'test-card';
        status.textContent = '‚è≥';
        iframeContainer.style.display = 'none';
        body.classList.remove('show');
      });

      // Reset progress
      document.getElementById('progress-bar').style.width = '0%';
      document.getElementById('progress-bar').textContent = '0%';
      document.getElementById('progress-text').textContent = 'Ready to run';
      document.getElementById('progress-container').style.display = 'none';
      document.getElementById('progress-text').style.display = 'none';

      // Reset results
      results = { passed: 0, failed: 0, pending: 6 };
      updateSummary();
    }

    // Initialize
    renderScenarios();
  </script>
</body>
</html>
