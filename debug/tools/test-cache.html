<!DOCTYPE html>
<html>
<head>
  <title>Cache Test</title>
</head>
<body>
  <h1>LocalStorage Cache Test</h1>
  <button onclick="testCache()">Test Cache</button>
  <button onclick="clearCache()">Clear Cache</button>
  <pre id="output"></pre>
  
  <script>
    const output = document.getElementById('output');
    
    function log(msg) {
      output.textContent += msg + '\n';
      console.log(msg);
    }
    
    async function testCache() {
      output.textContent = '';
      
      // Check if cache exists
      const cached = localStorage.getItem('serpent_products_cache');
      const cacheTime = localStorage.getItem('serpent_products_cache_time');
      
      if (cached && cacheTime) {
        const age = Date.now() - parseInt(cacheTime);
        const ageMin = Math.floor(age / 60000);
        const ageSec = Math.floor((age % 60000) / 1000);
        
        log(`‚úÖ Cache exists!`);
        log(`   Age: ${ageMin}m ${ageSec}s`);
        log(`   Size: ${(cached.length / 1024).toFixed(2)} KB`);
        log(`   Products: ${JSON.parse(cached).length}`);
        log(`   Expires: ${Math.max(0, 300 - Math.floor(age / 1000))}s`);
      } else {
        log(`‚ùå No cache found`);
        log(`   Fetching from API...`);
        
        const start = Date.now();
        const response = await fetch('https://catalog.navickaszilvinas.workers.dev/products');
        const data = await response.json();
        const duration = Date.now() - start;
        
        log(`‚úÖ Fetched in ${duration}ms`);
        log(`   Products: ${data.length}`);
        
        // Cache it
        localStorage.setItem('serpent_products_cache', JSON.stringify(data));
        localStorage.setItem('serpent_products_cache_time', Date.now().toString());
        log(`üíæ Cached!`);
      }
    }
    
    function clearCache() {
      localStorage.removeItem('serpent_products_cache');
      localStorage.removeItem('serpent_products_cache_time');
      output.textContent = 'üóëÔ∏è Cache cleared!\n';
    }
  </script>
</body>
</html>
