<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üêç Debug Hub - Snake Muffin</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0e14;
      color: #c9d1d9;
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }
    h1 { color: #58a6ff; margin-bottom: 10px; }
    .subtitle { color: #8b949e; margin-bottom: 30px; font-size: 14px; }
    .modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .module-card {
      background: #161b22;
      border: 2px solid #30363d;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.2s;
    }
    .module-card:hover {
      border-color: #58a6ff;
      transform: translateY(-2px);
    }
    .module-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      cursor: pointer;
    }
    .module-title { font-size: 18px; font-weight: 600; color: #58a6ff; }
    .module-badge {
      background: #238636;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
    }
    .module-stats {
      display: flex;
      gap: 15px;
      margin-top: 10px;
      font-size: 13px;
      color: #8b949e;
    }
    .stat-item { display: flex; align-items: center; gap: 5px; }
    .progress-bar-mini {
      width: 100%;
      height: 8px;
      background: #21262d;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    .progress-fill-mini {
      height: 100%;
      background: linear-gradient(90deg, #238636, #2ea043);
      transition: width 0.3s;
    }
    .subcategories {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .module-links {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 15px;
    }
    .module-link {
      color: #58a6ff;
      text-decoration: none;
      font-size: 13px;
      padding: 8px;
      background: #0d1117;
      border-radius: 6px;
      transition: all 0.2s;
    }
    .module-link:hover {
      background: #1c2128;
      transform: translateX(5px);
    }
    .subcat-badge {
      background: #21262d;
      color: #8b949e;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
    }
    details { margin-top: 15px; }
    summary {
      cursor: pointer;
      color: #58a6ff;
      font-size: 12px;
      padding: 8px;
      background: #0d1117;
      border-radius: 6px;
    }
    summary:hover { background: #161b22; }
  </style>
</head>
<body>
  <h1>üêç Snake Muffin - Debug Hub</h1>
  <p class="subtitle">
    <strong>Version:</strong> <span id="app-version">Loading...</span> | 
    <strong>SMRI:</strong> <span id="smri-count">Loading...</span> scenarios | 
    <strong>Progress:</strong> <span id="overall-progress">Loading...</span>
  </p>

  <!-- Quick Access -->
  <div style="background: #161b22; border: 2px solid #30363d; border-radius: 12px; padding: 20px; margin-bottom: 30px;">
    <h2 style="color: #58a6ff; margin-bottom: 15px; font-size: 18px;">üöÄ Quick Access</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
      <a href="catalog-demo.html" style="background: linear-gradient(135deg, #1f6feb 0%, #0969da 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üõí Catalog Demo<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Product listing from KV (S1.5-11.1.01)</span>
      </a>
      <a href="purchase-flow-demo.html" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üí≥ Purchase Flow Demo<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Interactive E2E test (S1.1,2,3,4,5.01)</span>
      </a>
      <a href="healthcheck.html" style="background: linear-gradient(135deg, #238636 0%, #2ea043 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üè• System Health Check<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Test all API endpoints</span>
      </a>
      <a href="customer-debug.html" style="background: linear-gradient(135deg, #8957e5 0%, #9d6fcf 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üîç Customer Management<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Test customer creation & login flow</span>
      </a>
      <a href="data-manager.html" style="background: linear-gradient(135deg, #f85149 0%, #ff6b6b 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üìä Data Manager<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Inspect Stripe, KV, Worker API</span>
      </a>
      <a href="tutorial-collection-runner.html" style="background: linear-gradient(135deg, #f77f00 0%, #ff8500 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üêç Tutorial Collection Runner<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Run all 6 scenarios at once (S2-7.x)</span>
      </a>
      <a href="tutorial-happy-path.html" style="background: linear-gradient(135deg, #d29922 0%, #e3a82b 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üü¢ Happy Path<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Daily care routine (S2-7.x.01)</span>
      </a>
      <a href="tutorial-missed-care.html" style="background: linear-gradient(135deg, #8957e5 0%, #9d6fcf 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        ‚ö†Ô∏è Missed Care<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">2-3 days neglect (S2-7.x.02)</span>
      </a>
    </div>
  </div>

  <div class="modules-grid" id="modules-grid">
    Loading modules...
  </div>

  <script type="module">
    import { VERSION, VERSION_CONFIG, getSMRIStats } from '../src/config/version.js';

    const stats = getSMRIStats();
    document.getElementById('app-version').textContent = VERSION.substring(1);
    document.getElementById('smri-count').textContent = stats.total;
    document.getElementById('overall-progress').textContent = `${stats.completed}/${stats.total} done (${stats.avgProgress}%)`;

    const moduleGroups = {};
    const moduleNames = {
      'S0': { name: 'Health Checks', icon: 'üè•', color: '#238636' },
      'S1': { name: 'Shop', icon: 'üõí', color: '#1f6feb' },
      'S2': { name: 'Game', icon: 'üéÆ', color: '#8957e5' },
      'S2-7': { name: 'Tutorial (Game)', icon: 'üêç', color: '#f77f00' },
      'S3': { name: 'Auth', icon: 'üîê', color: '#d29922' },
      'S4': { name: 'Payment', icon: 'üí≥', color: '#f85149' },
      'S5': { name: 'Worker', icon: '‚òÅÔ∏è', color: '#58a6ff' }
    };
    
    // Map scenario codes to their proper module groups (prevent S0-1, S0-2, etc. from appearing)
    const moduleMapping = {
      'S0-1': 'S0',
      'S0-2': 'S0', 
      'S0-3': 'S0',
      'S0-4': 'S0',
      'S0-5': 'S0',
      'S0-11': 'S0',
      'S0-12': 'S0'
    };

    VERSION_CONFIG.SMRI_SCENARIOS.forEach(scenario => {
      const match = scenario.code.match(/^(S\d+-?\d*)/);
      if (match) {
        let mainModule = match[1];
        
        // Map old-style codes (S0-1, S0-2) to their parent module (S0)
        if (moduleMapping[mainModule]) {
          mainModule = moduleMapping[mainModule];
        }
        
        if (!moduleGroups[mainModule]) {
          moduleGroups[mainModule] = { scenarios: [], subcategories: new Set(), totalProgress: 0 };
        }
        moduleGroups[mainModule].scenarios.push(scenario);
        moduleGroups[mainModule].totalProgress += scenario.done;
        
        // Extract subcategory for display
        const subMatch = scenario.code.match(/^S\d+-(\d+)/);
        if (subMatch) moduleGroups[mainModule].subcategories.add(subMatch[1]);
      }
    });

    const grid = document.getElementById('modules-grid');
    grid.innerHTML = '';

    Object.keys(moduleGroups).sort().forEach(moduleKey => {
      const group = moduleGroups[moduleKey];
      const meta = moduleNames[moduleKey] || { name: moduleKey, icon: 'üì¶', color: '#6e7681' };
      const avgProgress = Math.round(group.totalProgress / group.scenarios.length);
      const completed = group.scenarios.filter(s => s.done === 100).length;

      const card = document.createElement('div');
      card.className = 'module-card';
      card.innerHTML = `
        <div class="module-header">
          <div class="module-title">${meta.icon} ${meta.name}</div>
          <div class="module-badge">${moduleKey}</div>
        </div>
        <div class="module-stats">
          <div class="stat-item">üìä ${group.scenarios.length} scenarios</div>
          <div class="stat-item">‚úÖ ${completed} done</div>
        </div>
        <div class="progress-bar-mini">
          <div class="progress-fill-mini" style="width: ${avgProgress}%; background: ${meta.color}"></div>
        </div>
        <div style="margin-top: 8px; font-size: 12px; color: #8b949e;">${avgProgress}% average</div>
        ${group.subcategories.size > 0 ? `<div class="subcategories">${Array.from(group.subcategories).map(sub => `<span class="subcat-badge">${moduleKey}-${sub}</span>`).join('')}</div>` : ''}
        <details>
          <summary>üìã View all ${group.scenarios.length} scenarios</summary>
          <div style="margin-top: 10px; max-height: 300px; overflow-y: auto;">
            ${group.scenarios.map(s => {
              const icon = s.done === 100 ? '‚úÖ' : s.done > 0 ? 'üöß' : '‚è≥';
              const color = s.done === 100 ? '#3fb950' : s.done > 0 ? '#d29922' : '#8b949e';
              return `<div style="padding: 6px; font-size: 11px; border-bottom: 1px solid #30363d;">${icon} <strong style="color: #c9d1d9;">${s.code}</strong> - ${s.desc} <span style="color: ${color}">(${s.done}%)</span></div>`;
            }).join('')}
          </div>
        </details>
      `;

      // Add tutorial links for S2-7 module
      if (moduleKey === 'S2-7') {
        const tutorialLinks = document.createElement('div');
        tutorialLinks.className = 'module-links';
        tutorialLinks.innerHTML = `
          <a href="tutorial-happy-path.html" class="module-link">üêç Happy Path</a>
          <a href="tutorial-missed-care.html" class="module-link">‚ö†Ô∏è Missed Care</a>
          <a href="tutorial-education-commerce.html" class="module-link">üìö Education-First</a>
          <a href="tutorial-trust-protection.html" class="module-link">üõ°Ô∏è Trust Protection</a>
          <a href="tutorial-email-reentry.html" class="module-link">üìß Email Re-entry</a>
          <a href="tutorial-failure-educational.html" class="module-link">üíÄ Failure Case</a>
        `;
        card.appendChild(tutorialLinks);
      }
      
      card.querySelector('.module-header').addEventListener('click', () => {
        if (moduleKey === 'S0') window.location.href = 'healthcheck.html';
        if (moduleKey === 'S2-7') {
          // Toggle tutorial links visibility
          const links = card.querySelector('.module-links');
          if (links) links.style.display = links.style.display === 'none' ? 'flex' : 'none';
        }
      });

      grid.appendChild(card);
    });
  </script>
</body>
</html>
