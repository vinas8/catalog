<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üêç Debug Hub - Serpent Town</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0e14;
      color: #c9d1d9;
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }
    h1 { color: #58a6ff; margin-bottom: 10px; }
    .subtitle { color: #8b949e; margin-bottom: 30px; font-size: 14px; }
    .modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .module-card {
      background: #161b22;
      border: 2px solid #30363d;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.2s;
    }
    .module-card:hover {
      border-color: #58a6ff;
      transform: translateY(-2px);
    }
    .module-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      cursor: pointer;
    }
    .module-title { font-size: 18px; font-weight: 600; color: #58a6ff; }
    .module-badge {
      background: #238636;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
    }
    .module-stats {
      display: flex;
      gap: 15px;
      margin-top: 10px;
      font-size: 13px;
      color: #8b949e;
    }
    .stat-item { display: flex; align-items: center; gap: 5px; }
    .progress-bar-mini {
      width: 100%;
      height: 8px;
      background: #21262d;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    .progress-fill-mini {
      height: 100%;
      background: linear-gradient(90deg, #238636, #2ea043);
      transition: width 0.3s;
    }
    .subcategories {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .subcat-badge {
      background: #21262d;
      color: #8b949e;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
    }
    details { margin-top: 15px; }
    summary {
      cursor: pointer;
      color: #58a6ff;
      font-size: 12px;
      padding: 8px;
      background: #0d1117;
      border-radius: 6px;
    }
    summary:hover { background: #161b22; }
  </style>
</head>
<body>
  <h1>üêç Serpent Town - Debug Hub</h1>
  <p class="subtitle">
    <strong>Version:</strong> <span id="app-version">Loading...</span> | 
    <strong>SMRI:</strong> <span id="smri-count">Loading...</span> scenarios | 
    <strong>Progress:</strong> <span id="overall-progress">Loading...</span>
  </p>

  <div class="modules-grid" id="modules-grid">
    Loading modules...
  </div>

  <script type="module">
    import { VERSION, VERSION_CONFIG, getSMRIStats } from '../src/config/version.js';

    const stats = getSMRIStats();
    document.getElementById('app-version').textContent = VERSION.substring(1);
    document.getElementById('smri-count').textContent = stats.total;
    document.getElementById('overall-progress').textContent = `${stats.completed}/${stats.total} done (${stats.avgProgress}%)`;

    const moduleGroups = {};
    const moduleNames = {
      'S0': { name: 'Health Checks', icon: 'üè•', color: '#238636' },
      'S1': { name: 'Shop', icon: 'üõí', color: '#1f6feb' },
      'S2': { name: 'Game', icon: 'üéÆ', color: '#8957e5' },
      'S3': { name: 'Auth', icon: 'üîê', color: '#d29922' },
      'S4': { name: 'Payment', icon: 'üí≥', color: '#f85149' },
      'S5': { name: 'Worker', icon: '‚òÅÔ∏è', color: '#58a6ff' }
    };

    VERSION_CONFIG.SMRI_SCENARIOS.forEach(scenario => {
      const match = scenario.code.match(/^S(\d+)/);
      if (match) {
        const mainModule = 'S' + match[1];
        if (!moduleGroups[mainModule]) {
          moduleGroups[mainModule] = { scenarios: [], subcategories: new Set(), totalProgress: 0 };
        }
        moduleGroups[mainModule].scenarios.push(scenario);
        moduleGroups[mainModule].totalProgress += scenario.done;
        const subMatch = scenario.code.match(/^S\d+-(\d+)/);
        if (subMatch) moduleGroups[mainModule].subcategories.add(subMatch[1]);
      }
    });

    const grid = document.getElementById('modules-grid');
    grid.innerHTML = '';

    Object.keys(moduleGroups).sort().forEach(moduleKey => {
      const group = moduleGroups[moduleKey];
      const meta = moduleNames[moduleKey] || { name: moduleKey, icon: 'üì¶', color: '#6e7681' };
      const avgProgress = Math.round(group.totalProgress / group.scenarios.length);
      const completed = group.scenarios.filter(s => s.done === 100).length;

      const card = document.createElement('div');
      card.className = 'module-card';
      card.innerHTML = `
        <div class="module-header">
          <div class="module-title">${meta.icon} ${meta.name}</div>
          <div class="module-badge">${moduleKey}</div>
        </div>
        <div class="module-stats">
          <div class="stat-item">üìä ${group.scenarios.length} scenarios</div>
          <div class="stat-item">‚úÖ ${completed} done</div>
        </div>
        <div class="progress-bar-mini">
          <div class="progress-fill-mini" style="width: ${avgProgress}%; background: ${meta.color}"></div>
        </div>
        <div style="margin-top: 8px; font-size: 12px; color: #8b949e;">${avgProgress}% average</div>
        ${group.subcategories.size > 0 ? `<div class="subcategories">${Array.from(group.subcategories).map(sub => `<span class="subcat-badge">${moduleKey}-${sub}</span>`).join('')}</div>` : ''}
        <details>
          <summary>üìã View all ${group.scenarios.length} scenarios</summary>
          <div style="margin-top: 10px; max-height: 300px; overflow-y: auto;">
            ${group.scenarios.map(s => {
              const icon = s.done === 100 ? '‚úÖ' : s.done > 0 ? 'üöß' : '‚è≥';
              const color = s.done === 100 ? '#3fb950' : s.done > 0 ? '#d29922' : '#8b949e';
              return `<div style="padding: 6px; font-size: 11px; border-bottom: 1px solid #30363d;">${icon} <strong style="color: #c9d1d9;">${s.code}</strong> - ${s.desc} <span style="color: ${color}">(${s.done}%)</span></div>`;
            }).join('')}
          </div>
        </details>
      `;

      card.querySelector('.module-header').addEventListener('click', () => {
        if (moduleKey === 'S0') window.location.href = '/debug/healthcheck.html';
      });

      grid.appendChild(card);
    });
  </script>
</body>
</html>
