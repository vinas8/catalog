<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>üêç Debug Hub - Snake Muffin v0.7.2</title>
  <link rel="stylesheet" href="../styles.css?v=20260104">
  <script type="module" src="../src/components/Navigation.js"></script>
  <style>
    .debug-content {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0e14;
      color: #c9d1d9;
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
      min-height: 100vh;
    }
    body { background: #0a0e14; }
    h1 { color: #58a6ff; margin-bottom: 10px; }
    .subtitle { color: #8b949e; margin-bottom: 30px; font-size: 14px; }
    .modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .module-card {
      background: #161b22;
      border: 2px solid #30363d;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.2s;
    }
    .module-card:hover {
      border-color: #58a6ff;
      transform: translateY(-2px);
    }
    .module-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      cursor: pointer;
    }
    .module-title { font-size: 18px; font-weight: 600; color: #58a6ff; }
    .module-badge {
      background: #238636;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
    }
    .module-stats {
      display: flex;
      gap: 15px;
      margin-top: 10px;
      font-size: 13px;
      color: #8b949e;
    }
    .stat-item { display: flex; align-items: center; gap: 5px; }
    .progress-bar-mini {
      width: 100%;
      height: 8px;
      background: #21262d;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    .progress-fill-mini {
      height: 100%;
      background: linear-gradient(90deg, #238636, #2ea043);
      transition: width 0.3s;
    }
    .subcategories {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .module-links {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 15px;
    }
    .module-link {
      color: #58a6ff;
      text-decoration: none;
      font-size: 13px;
      padding: 8px;
      background: #0d1117;
      border-radius: 6px;
      transition: all 0.2s;
    }
    .module-link:hover {
      background: #1c2128;
      transform: translateX(5px);
    }
    .subcat-badge {
      background: #21262d;
      color: #8b949e;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
    }
    details { margin-top: 15px; }
    summary {
      cursor: pointer;
      color: #58a6ff;
      font-size: 12px;
      padding: 8px;
      background: #0d1117;
      border-radius: 6px;
    }
    summary:hover { background: #161b22; }
  </style>
</head>
<body>
  <div class="debug-content">
    <h1>üêç Snake Muffin - Debug Hub</h1>
    <p class="subtitle">
      <strong>Version:</strong> <span id="app-version">Loading...</span> | 
      <strong>SMRI:</strong> <span id="smri-count">Loading...</span> scenarios | 
      <strong>Progress:</strong> <span id="overall-progress">Loading...</span> |
      <strong>Updated:</strong> <span id="page-timestamp" style="color: #8b949e; font-size: 12px;">2026-01-04</span>
  </p>

  <!-- Quick Access -->
  <div style="background: #161b22; border: 2px solid #30363d; border-radius: 12px; padding: 20px; margin-bottom: 30px;">
    <h2 style="color: #58a6ff; margin-bottom: 15px; font-size: 18px;">üöÄ Quick Access</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
      <a href="../catalog.html" style="background: linear-gradient(135deg, #1f6feb 0%, #0969da 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üõí Live Catalog<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Product listing from KV with Stripe checkout</span>
      </a>
      <a href="purchase-flow-demo.html" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üí≥ Purchase Flow Demo<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Interactive E2E test (S1.1,2,3,4,5.01)</span>
      </a>
      <a href="healthcheck.html" style="background: linear-gradient(135deg, #238636 0%, #2ea043 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üè• System Health Check<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Test all API endpoints</span>
      </a>
      <a href="smri-runner.html" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üß™ SMRI Test Runner (NEW)<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Integrated browser testing with live rendering</span>
      </a>
      <a href="kv-manager.html" style="background: linear-gradient(135deg, #f85149 0%, #ff6b6b 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üìä KV Manager<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Inspect & manage KV storage data</span>
      </a>
      <a href="test-cache.html" style="background: linear-gradient(135deg, #d946ef 0%, #c026d3 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üíæ Cache Test Tool<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Test localStorage performance</span>
      </a>
      <a href="trait-dex.html" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üìñ Trait Dex<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Browse genetics & morphs database</span>
      </a>
      <a href="calc/" style="background: linear-gradient(135deg, #9333ea 0%, #7e22ce 100%); color: white; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; display: block;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        üß¨ Breeding Calculator<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.9;">Genetics matrix & compatibility</span>
      </a>
    </div>
  </div>

  <div class="modules-grid" id="modules-grid">
    Loading modules...
  </div>

  <script type="module">
    import { VERSION, VERSION_CONFIG, getSMRIStats } from '../src/config/version.js?v=20260104';

    console.log('üêõ Debug Hub Loading...');
    console.log('üì¶ VERSION:', VERSION);
    console.log('üì¶ VERSION_CONFIG.CURRENT:', VERSION_CONFIG.CURRENT);

    const stats = getSMRIStats();
    document.getElementById('app-version').textContent = VERSION.substring(1);
    document.getElementById('smri-count').textContent = stats.total;
    document.getElementById('overall-progress').textContent = `${stats.completed}/${stats.total} done (${stats.avgProgress}%)`;
    
    console.log('‚úÖ Version displayed:', VERSION.substring(1));

    const moduleGroups = {};
    const moduleNames = {
      'S0': { name: 'Health Checks', icon: 'üè•', color: '#238636' },
      'S1': { name: 'Shop', icon: 'üõí', color: '#1f6feb' },
      'S2': { name: 'Game', icon: 'üéÆ', color: '#8957e5' },
      'S2-7': { name: 'Tutorial (Game)', icon: 'üêç', color: '#f77f00' },
      'S3': { name: 'Auth', icon: 'üîê', color: '#d29922' },
      'S4': { name: 'Payment', icon: 'üí≥', color: '#f85149' },
      'S5': { name: 'Worker', icon: '‚òÅÔ∏è', color: '#58a6ff' }
    };
    
    // Map scenario codes to their proper module groups (prevent S0-1, S0-2, etc. from appearing)
    const moduleMapping = {
      'S0-1': 'S0',
      'S0-2': 'S0', 
      'S0-3': 'S0',
      'S0-4': 'S0',
      'S0-5': 'S0',
      'S0-11': 'S0',
      'S0-12': 'S0'
    };

    VERSION_CONFIG.SMRI_SCENARIOS.forEach(scenario => {
      const match = scenario.code.match(/^(S\d+-?\d*)/);
      if (match) {
        let mainModule = match[1];
        
        // Map old-style codes (S0-1, S0-2) to their parent module (S0)
        if (moduleMapping[mainModule]) {
          mainModule = moduleMapping[mainModule];
        }
        
        if (!moduleGroups[mainModule]) {
          moduleGroups[mainModule] = { scenarios: [], subcategories: new Set(), totalProgress: 0 };
        }
        moduleGroups[mainModule].scenarios.push(scenario);
        moduleGroups[mainModule].totalProgress += scenario.done;
        
        // Extract subcategory for display
        const subMatch = scenario.code.match(/^S\d+-(\d+)/);
        if (subMatch) moduleGroups[mainModule].subcategories.add(subMatch[1]);
      }
    });

    const grid = document.getElementById('modules-grid');
    grid.innerHTML = '';

    Object.keys(moduleGroups).sort().forEach(moduleKey => {
      const group = moduleGroups[moduleKey];
      const meta = moduleNames[moduleKey] || { name: moduleKey, icon: 'üì¶', color: '#6e7681' };
      const avgProgress = Math.round(group.totalProgress / group.scenarios.length);
      const completed = group.scenarios.filter(s => s.done === 100).length;

      const card = document.createElement('div');
      card.className = 'module-card';
      
      // Check if module has a collection page
      const hasCollectionPage = ['S0', 'S1', 'S2-7'].includes(moduleKey);
      const clickHint = hasCollectionPage ? '<div style="font-size: 11px; color: #58a6ff; margin-top: 5px;">üëÜ Click header to open collection runner</div>' : '';
      
      card.innerHTML = `
        <div class="module-header" style="${hasCollectionPage ? 'background: rgba(88, 166, 255, 0.1); padding: 10px; border-radius: 6px; margin: -5px; margin-bottom: 10px;' : ''}">
          <div class="module-title">${meta.icon} ${meta.name}</div>
          <div class="module-badge">${moduleKey}</div>
        </div>
        ${clickHint}
        <div class="module-stats">
          <div class="stat-item">üìä ${group.scenarios.length} scenarios</div>
          <div class="stat-item">‚úÖ ${completed} done</div>
        </div>
        <div class="progress-bar-mini">
          <div class="progress-fill-mini" style="width: ${avgProgress}%; background: ${meta.color}"></div>
        </div>
        <div style="margin-top: 8px; font-size: 12px; color: #8b949e;">${avgProgress}% average</div>
        ${group.subcategories.size > 0 ? `<div class="subcategories">${Array.from(group.subcategories).map(sub => `<span class="subcat-badge">${moduleKey}-${sub}</span>`).join('')}</div>` : ''}
        <details>
          <summary>üìã View all ${group.scenarios.length} scenarios</summary>
          <div style="margin-top: 10px; max-height: 300px; overflow-y: auto;">
            ${group.scenarios.map(s => {
              const icon = s.done === 100 ? '‚úÖ' : s.done > 0 ? 'üöß' : '‚è≥';
              const color = s.done === 100 ? '#3fb950' : s.done > 0 ? '#d29922' : '#8b949e';
              return `<div style="padding: 6px; font-size: 11px; border-bottom: 1px solid #30363d;">${icon} <strong style="color: #c9d1d9;">${s.code}</strong> - ${s.desc} <span style="color: ${color}">(${s.done}%)</span></div>`;
            }).join('')}
          </div>
        </details>
      `;

      // Archived - no links needed
      
      card.querySelector('.module-header').addEventListener('click', () => {
        // Module-specific pages
        const modulePages = {
          'S0': 'healthcheck.html',
          'S1': '../catalog.html',  // Live catalog
          'S2': null,  // No collection page yet
          'S2-7': null,  // Archived
          'S3': null,  // Auth - no collection page
          'S4': null,  // Payment - no collection page  
          'S5': null   // Worker - no collection page
        };
        
        const page = modulePages[moduleKey];
        if (page) {
          window.location.href = page;
        } else {
          // Show message if no collection page exists
          alert(`üìã ${meta.name} scenarios\n\nNo collection runner page yet. Scenarios are listed below.`);
        }
      });

      grid.appendChild(card);
    });
  </script>
  </div><!-- .debug-content -->
</body>
</html>
