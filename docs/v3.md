# ğŸ Serpent Town - Complete Platform Specification v3.0 (FINAL)

**Mission**: Build a snake care gaming platform using **Godot + JavaScript + GitHub Pages + Cloudflare Worker + Stripe** that drives real breeding business sales, establishes brand authority, creates loyal customer community, and becomes the collaborative marketplace for snake farm owners.

---

## ğŸ“‹ ANSWERS TO CRITICAL QUESTIONS (v3 Updates)

### Q1: Shipping Logistics âœ…
**ANSWER**: Snakes shipped from Thailand. Logistics handled externally (not in-game concern for MVP).

### Q2: Data Structure âœ…
**ANSWER**: Use Stripe format for products (easy adaptation). Products should match Stripe schema to minimize data transformation.

### Q3: Tech Stack âœ…
**ANSWER**: 
- **Game Engine**: Godot (G-O-D-O-T)
- **Language**: Plain JavaScript (no React, no TypeScript)
- **Hosting**: GitHub Pages
- **Backend**: Cloudflare Worker (optional)
- **E-commerce**: Stripe + separate website on GitHub Pages
- **Forum**: Web-based, also accessible in-game (no duplication)

### Q4: Real vs Virtual UX âœ…
**ANSWER**: 
- Snake cards have **different colors** (real vs virtual)
- **"Virtual" badge/text** on virtual snake cards
- User can clearly see distinction

### Q5: Care Frequency âœ…
**ANSWER**:
- **Realistic** - same as real snake care requirements
- **Vacation mode** - go to NPC (doctor or caretaker) in-game
- **Time slider** - fast-forward through events (egg hatching, etc.)
- Real snakes: Feed every 7-14 days (adults), 5-7 days (babies)

### Q6: Genetics MVP Scope âœ…
**ANSWER**: **Full genetics calculator** from the start (core feature for farm owners).

### Q7: Premium Model âœ…
**ANSWER**:
- Real snake buyers: **FREE in-game care items/currency as bonus**
- Goal: Engage buyers to have collection in-game
- Goal: Engage other farms to use calculator and forum
- Forum accessible both web and in-game (same platform, no duplication)

### Q8: Auth Requirement âœ…
**ANSWER**: **Email-based authentication** (for Stripe integration, user identification).

### Q9: Content Moderation âœ…
**ANSWER**: 
- Snakes created in **Stripe** (upload pictures there)
- Content managed through Stripe product system
- No in-game snake creation initially

### Q10: Farm Vetting âœ…
**ANSWER**:
- **No strict requirements** for players
- Every player has a **farm** (their own collection space)
- Tutorial gives **virtual snake** to start
- Players can replicate/showcase their farm in-game

---

## ğŸ® REVISED GAME ARCHITECTURE (Godot-Based)

### Tech Stack (FINAL)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Godot Game Engine (GDScript/JavaScript)   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Town Hub â”‚  â”‚   Farm   â”‚  â”‚ Care UI  â”‚ â”‚
â”‚  â”‚ (Scene)  â”‚  â”‚ (Scene)  â”‚  â”‚ (Scene)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  JavaScript Layer (Godot HTML5)      â”‚  â”‚
â”‚  â”‚  - Stripe API calls                  â”‚  â”‚
â”‚  â”‚  - Cloudflare Worker API             â”‚  â”‚
â”‚  â”‚  - LocalStorage save/load            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  GitHub Pages (Host)  â”‚
        â”‚  - Game build (HTML5) â”‚
        â”‚  - E-commerce site    â”‚
        â”‚  - Forum (web)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Cloudflare Worker    â”‚
        â”‚  - API endpoints      â”‚
        â”‚  - Stripe webhooks    â”‚
        â”‚  - User data (KV)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Stripe                â”‚
        â”‚  - Products (snakes)  â”‚
        â”‚  - Photos             â”‚
        â”‚  - Payments           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why Godot?
âœ… **Free & open-source**
âœ… **HTML5 export** (works in browser)
âœ… **JavaScript support** (via HTML5 export)
âœ… **Scene system** (perfect for town â†’ farm â†’ care flow)
âœ… **Built-in UI tools** (inventory, cards, sliders)
âœ… **2D focus** (snake cards, stats UI)
âœ… **Lightweight** (small bundle size)
âœ… **Mobile-friendly** (touch support, responsive)

---

## ğŸ—ï¸ GAME STRUCTURE (Godot Scenes)

### Main Scenes

1. **TownHub.tscn** (Main menu)
   - Navigate to: Farm, Shop, Forum, Social, Services
   - Display: User stats (gold, loyalty, collection count)

2. **Farm.tscn** (Player's collection)
   - Grid of snake cards (owned snakes)
   - Click snake â†’ SnakeCare.tscn
   - "Buy Room" button (expand capacity)

3. **SnakeCare.tscn** (Tamagotchi interface)
   - Snake image/sprite
   - Stats (hunger, water, temp, humidity, health, stress, weight, shed)
   - Action buttons (feed, water, clean, handle, breed, vet)
   - Time slider (fast-forward)

4. **Shop.tscn** (Browse snakes)
   - Display Stripe products (via API call)
   - Real snakes (photos, Stripe links)
   - Virtual snakes (in-game currency)
   - Different card colors (real vs virtual)

5. **GeneticsCalculator.tscn** (Breeding tool)
   - Select 2 parent snakes
   - Punnett square display
   - Offspring predictions (morphs, probabilities)
   - Educational tooltips

6. **Forum.tscn** (Community - embedded web view)
   - Web-based forum (GitHub Discussions or Discourse)
   - Accessible in-game via iframe/webview
   - Same forum as standalone website (no duplication)

7. **VacationMode.tscn** (NPC care service)
   - Select snake(s) to put under care
   - Choose duration (3 days, 7 days, 14 days)
   - Pay in-game currency
   - Stats pause, no decay

---

## ğŸ’¾ DATA MODELS (Stripe-Compatible)

### Product Schema (Stripe + In-Game)

```json
{
  "id": "prod_stripe_id",
  "name": "Super Banana Ball Python",
  "description": "Male â€¢ 2024 â€¢ Captive Bred",
  "images": ["https://stripe.com/img/snake1.jpg"],
  "metadata": {
    "species": "Ball Python",
    "morph": "Super Banana",
    "genetics": {
      "banana": { "allele1": "Ban", "allele2": "Ban" }
    },
    "sex": "male",
    "birth_date": "2024-01-15",
    "weight_grams": 450,
    "feeding": "frozen_thawed_mice",
    "temperament": "docile",
    "care_profile": "ball_python_standard",
    "snake_type": "real",
    "origin_country": "Thailand"
  },
  "unit_amount": 45000,
  "currency": "usd",
  "active": true
}
```

**Virtual Snake** (in-game only):
```json
{
  "id": "virtual_corn_snake_001",
  "name": "Corn Snake (Starter)",
  "metadata": {
    "species": "Corn Snake",
    "morph": "Normal",
    "snake_type": "virtual",
    "care_profile": "corn_snake_standard"
  },
  "unit_amount": 0,
  "currency": "gold_coins"
}
```

### User Save Data (LocalStorage/Cloudflare KV)

```json
{
  "user_id": "user_email@example.com",
  "created_at": "2024-01-01T00:00:00Z",
  "loyalty_tier": "silver",
  "loyalty_points": 450,
  "currency": {
    "gold_coins": 1250,
    "gems": 50
  },
  "snakes": [
    {
      "id": "snake_instance_001",
      "product_id": "prod_stripe_id",
      "nickname": "Banana Joe",
      "acquired_date": "2024-01-15T10:00:00Z",
      "acquisition_type": "purchase",
      "stats": {
        "hunger": 80,
        "water": 100,
        "temperature": 88,
        "humidity": 60,
        "health": 85,
        "stress": 15,
        "happiness": 90
      },
      "weight_grams": 460,
      "life_stage": "adult",
      "last_fed": "2024-01-20T08:00:00Z",
      "shed_cycle": {
        "stage": "normal",
        "days_until_shed": 12
      },
      "in_vacation_mode": false
    }
  ],
  "rooms": [
    { "id": "room_1", "capacity": 20, "occupied": 5 }
  ],
  "friends": ["friend_email@example.com"],
  "settings": {
    "notifications": true,
    "theme": "default"
  }
}
```

---

## ğŸ¨ UI DESIGN (Godot Scenes)

### Visual Style
- **Card-based** (snake cards like trading cards)
- **Minimalist** (clean, modern)
- **Color-coded**:
  - Real snakes: **Gold/yellow border**
  - Virtual snakes: **Blue/purple border**
- **Stat bars**: Progress bars (hunger, health, etc.)
- **Icons**: Emoji or simple SVG (ğŸ ğŸ” ğŸ’§ ğŸŒ¡ï¸ ğŸ’¦)

### Farm Scene Layout (Grid)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¡ My Farm          ğŸ’° 1,250 ğŸ† Silverâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Room 1 (5/20 snakes)               â”‚
â”‚                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”â”‚
â”‚ â”‚ğŸ  â”‚ â”‚ğŸ  â”‚ â”‚ğŸ  â”‚ â”‚ğŸ  â”‚ â”‚ğŸ  â”‚â”‚
â”‚ â”‚Realâ”‚ â”‚Virtâ”‚ â”‚Realâ”‚ â”‚Virtâ”‚ â”‚Realâ”‚â”‚
â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚
â”‚ [+ Buy Room - 500 gold]            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Shop] [Calculator] [Social] [?]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Snake Care Scene (Detailed)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ğŸ Super Banana (Adult, 460g)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    â”‚
â”‚      [SNAKE IMAGE - Sprite2D]      â”‚
â”‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Hunger    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%       â”‚
â”‚   Last fed: 2 days ago             â”‚
â”‚                                    â”‚
â”‚ ğŸ’§ Water     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%      â”‚
â”‚   Fresh                            â”‚
â”‚                                    â”‚
â”‚ ğŸŒ¡ï¸ Temp      [===â—===] 88Â°F       â”‚
â”‚   Hot: 90Â°F  Cool: 80Â°F           â”‚
â”‚                                    â”‚
â”‚ ğŸ’¦ Humidity  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 60%       â”‚
â”‚   [Mist] button                    â”‚
â”‚                                    â”‚
â”‚ â¤ï¸  Health   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 85%       â”‚
â”‚   Healthy                          â”‚
â”‚                                    â”‚
â”‚ ğŸ”„ Shed      Normal (12d left)    â”‚
â”‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Time: [====â—========] Fast Forwardâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Feed] [Water] [Clean] [Handle]   â”‚
â”‚ [Breed] [Vet] [Info] [Vacation]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§¬ GENETICS CALCULATOR (Full Implementation)

### Features (Phase 1 MVP)
- Select 2 parent snakes from collection
- Display genetic traits (dominant, recessive, co-dominant)
- Calculate Punnett square (all possible outcomes)
- Show probabilities for each morph
- Educational tooltips (explain genetics)

### Calculator UI
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§¬ Genetics Calculator             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Parent 1: [Select Snake â–¼]        â”‚
â”‚   Super Banana (BanBan)            â”‚
â”‚                                    â”‚
â”‚ Parent 2: [Select Snake â–¼]        â”‚
â”‚   Normal (++ / ++)                 â”‚
â”‚                                    â”‚
â”‚         Ã—                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Offspring Predictions:             â”‚
â”‚                                    â”‚
â”‚ 50% Banana (Ban/+)                 â”‚
â”‚ 50% Banana (Ban/+)                 â”‚
â”‚ 0%  Super Banana (Ban/Ban)         â”‚
â”‚ 0%  Normal (+/+)                   â”‚
â”‚                                    â”‚
â”‚ [More Details] [Breed Now]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Genetics Data Structure
```javascript
const morphTraits = {
  'banana': {
    type: 'co-dominant',
    allele_dominant: 'Ban',
    allele_recessive: '+',
    visual_single: 'Banana',
    visual_double: 'Super Banana'
  },
  'piebald': {
    type: 'recessive',
    allele_dominant: '+',
    allele_recessive: 'p',
    visual: 'Piebald' // only visible if pp
  },
  'spider': {
    type: 'dominant',
    allele_dominant: 'Sp',
    allele_recessive: '+',
    wobble_risk: 0.3, // genetic defect warning
    visual: 'Spider'
  }
};

function calculateOffspring(parent1_genetics, parent2_genetics) {
  const outcomes = [];
  const traits = Object.keys(parent1_genetics);
  
  for (const trait of traits) {
    const p1_alleles = [parent1_genetics[trait].allele1, parent1_genetics[trait].allele2];
    const p2_alleles = [parent2_genetics[trait].allele1, parent2_genetics[trait].allele2];
    
    // Punnett square (4 combinations)
    for (const p1_a of p1_alleles) {
      for (const p2_a of p2_alleles) {
        outcomes.push({ [trait]: [p1_a, p2_a] });
      }
    }
  }
  
  // Calculate percentages
  const counts = {};
  for (const outcome of outcomes) {
    const phenotype = determinePhenotype(outcome);
    counts[phenotype] = (counts[phenotype] || 0) + 1;
  }
  
  const total = outcomes.length;
  const probabilities = {};
  for (const [phenotype, count] of Object.entries(counts)) {
    probabilities[phenotype] = (count / total) * 100;
  }
  
  return probabilities;
}
```

---

## â±ï¸ TIME SYSTEM & VACATION MODE

### Real-Time + Fast-Forward Hybrid

**Normal Mode**:
- Stats decay in real-time (1 hour real = 1 hour game)
- Hunger drops 2 points/hour (species-dependent)
- Water drops 1 point/hour
- Temperature/humidity require equipment (heater, mister)

**Fast-Forward Mode** (Time Slider):
- Speed up time for events:
  - Egg incubation (60 days â†’ 5 minutes with slider at max)
  - Shedding cycle (14 days â†’ 2 minutes)
- Stats still decay (proportional to speed)
- Player must maintain care during fast-forward

**Vacation Mode**:
- Select snake(s) â†’ "Vacation Care" NPC
- Choose duration: 3, 7, or 14 days
- Cost: 50 gold/snake/day
- During vacation:
  - Stats **freeze** (no decay)
  - Cannot interact with snake
  - Snake shows "ğŸ–ï¸ On Vacation" badge
- Return: Click "End Vacation" â†’ stats resume

### Implementation (Godot)
```gdscript
# SnakeStats.gd
extends Node

var hunger = 100
var last_update_time = OS.get_unix_time()
var in_vacation_mode = false
var time_speed_multiplier = 1.0 # 1.0 = normal, 10.0 = fast-forward

func _process(delta):
    if in_vacation_mode:
        return # No decay
    
    var current_time = OS.get_unix_time()
    var time_passed = (current_time - last_update_time) * time_speed_multiplier
    
    # Decay hunger (2 points per hour)
    var hours_passed = time_passed / 3600.0
    hunger -= 2 * hours_passed
    hunger = max(0, hunger)
    
    last_update_time = current_time
    
    # Check death condition
    if hunger <= 0:
        trigger_starvation()
```

---

## ğŸ›’ SHOP & STRIPE INTEGRATION

### Shop Scene (Godot)

**Display Products**:
```gdscript
# Shop.gd
extends Control

var products = []

func _ready():
    load_products_from_stripe()

func load_products_from_stripe():
    # Call JavaScript bridge to Stripe API
    var stripe_api = JavaScript.eval("""
        fetch('/.netlify/functions/get-products')
        .then(res => res.json())
        .then(data => window.godot_products = data);
    """)
    
    # Wait for async load
    yield(get_tree().create_timer(1.0), "timeout")
    
    products = JavaScript.eval("window.godot_products", true)
    render_product_grid()

func render_product_grid():
    for product in products:
        var card = SnakeCard.instance()
        card.set_data(product)
        $GridContainer.add_child(card)

func _on_BuyButton_pressed(product_id):
    # Open Stripe payment link in new tab
    var stripe_link = get_product_stripe_link(product_id)
    OS.shell_open(stripe_link)
```

**Purchase Flow**:
1. Player clicks "Buy" on snake card
2. Opens Stripe payment link (new tab/window)
3. Player completes payment
4. Stripe webhook â†’ Cloudflare Worker
5. Worker adds snake to user's collection (KV store)
6. Player returns to game â†’ refresh â†’ snake appears in Farm

### Webhook Handler (Cloudflare Worker)
```javascript
// webhook.js
addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

async function handleRequest(request) {
  if (request.method === 'POST' && request.url.endsWith('/webhook/stripe')) {
    const body = await request.json()
    
    if (body.type === 'checkout.session.completed') {
      const session = body.data.object
      const user_email = session.customer_email
      const product_id = session.metadata.product_id
      
      // Add snake to user's collection in KV
      const user_data = await SERPENT_TOWN_KV.get(user_email, { type: 'json' })
      user_data.snakes.push({
        id: `snake_${Date.now()}`,
        product_id: product_id,
        acquired_date: new Date().toISOString(),
        acquisition_type: 'purchase',
        stats: getDefaultStats(product_id)
      })
      
      // Bonus: Give in-game currency
      user_data.currency.gold_coins += 500
      
      await SERPENT_TOWN_KV.put(user_email, JSON.stringify(user_data))
      
      return new Response('OK', { status: 200 })
    }
  }
  
  return new Response('Not Found', { status: 404 })
}
```

---

## ğŸŒ FORUM INTEGRATION (No Duplication)

### Approach: Single Forum, Multiple Access Points

**Setup**:
1. **GitHub Discussions** (free, integrated with repo)
   - Enable Discussions in repo settings
   - Categories: General, Breeding, Care, Marketplace, Off-Topic

2. **In-Game Access** (Godot WebView):
```gdscript
# Forum.gd
extends Control

func _ready():
    $WebViewContainer.load_url("https://github.com/your-repo/discussions")
```

**OR**

**Discourse Forum** (self-hosted or free tier):
```gdscript
func _ready():
    $WebViewContainer.load_url("https://forum.serpenttown.com")
```

**Benefits**:
- âœ… No duplication (same content, web + in-game)
- âœ… SEO benefit (web-accessible)
- âœ… Low maintenance (GitHub/Discourse handles moderation tools)
- âœ… Mobile-friendly (responsive design)

---

## ğŸ“Š REVISED IMPLEMENTATION ROADMAP

### **Phase 1: MVP (Weeks 1-6)** â­ CURRENT PRIORITY

**Week 1-2: Godot Setup + Core Loop**
- [ ] Set up Godot project (HTML5 export)
- [ ] Create basic scenes (TownHub, Farm, SnakeCare)
- [ ] Implement stat system (8 stats: hunger, water, temp, humidity, health, stress, weight, shed)
- [ ] Stat decay logic (real-time)
- [ ] Action buttons (feed, water, clean, handle)
- [ ] LocalStorage save/load

**Week 3-4: Shop + Stripe Integration**
- [ ] Shop scene (display products from Stripe API)
- [ ] Visual distinction (real vs virtual snake cards)
- [ ] Stripe payment link integration
- [ ] Cloudflare Worker (webhook handler)
- [ ] Auto-unlock purchased snakes
- [ ] Bonus currency on purchase

**Week 5-6: Genetics Calculator + Polish**
- [ ] Genetics calculator scene (Punnett square)
- [ ] Breeding mechanic (pair snakes, predict offspring)
- [ ] Tutorial (5-step onboarding)
- [ ] Time slider (fast-forward)
- [ ] Vacation mode (NPC care)
- [ ] Mobile responsive UI

**Success Criteria**:
- âœ… Player can register (email)
- âœ… Player gets starter virtual snake
- âœ… Player can care for snake (all 8 stats)
- âœ… Player can buy real snake (Stripe)
- âœ… Snake auto-appears in farm after purchase
- âœ… Player can use genetics calculator
- âœ… Player can breed 2 snakes (basic)
- âœ… Game saves/loads correctly
- âœ… Vacation mode works

---

### **Phase 2: Social & Collection (Weeks 7-12)**

**Features**:
- [ ] Multiple snakes (unlimited collection)
- [ ] Room system (buy additional rooms, 20 snakes each)
- [ ] Equipment shop (heaters, misters, auto-feeders)
- [ ] Friend system (add, visit farms)
- [ ] Trading (P2P snake/item trades)
- [ ] Forum integration (embedded GitHub Discussions)
- [ ] Leaderboards (collection size, care score)
- [ ] Achievement system (badges)

---

### **Phase 3: B2B Platform (Weeks 13-20)**

**Features**:
- [ ] Partner farm accounts (special permissions)
- [ ] Partner dashboard (list snakes, sales analytics)
- [ ] Marketplace listings (all farms visible)
- [ ] Commission system (10% platform fee via Stripe Connect)
- [ ] Advanced genetics (500+ morphs)
- [ ] Health system (illness, vet visits, treatments)
- [ ] Community events (seasonal challenges)

---

### **Phase 4: Scale & Polish (Weeks 21+)**

**Features**:
- [ ] Mobile app (Godot Android/iOS export)
- [ ] Animations (snake sprites, UI transitions)
- [ ] Audio (ambient music, sound effects)
- [ ] Advanced analytics (PostHog integration)
- [ ] Localization (Spanish, etc.)
- [ ] Accessibility (screen reader, colorblind mode)
- [ ] Expand to other reptiles (lizards, turtles)

---

## ğŸ—‚ï¸ PROJECT STRUCTURE (Godot + GitHub Pages)

```
serpent-town/
â”œâ”€â”€ godot-project/
â”‚   â”œâ”€â”€ project.godot
â”‚   â”œâ”€â”€ scenes/
â”‚   â”‚   â”œâ”€â”€ TownHub.tscn
â”‚   â”‚   â”œâ”€â”€ Farm.tscn
â”‚   â”‚   â”œâ”€â”€ SnakeCare.tscn
â”‚   â”‚   â”œâ”€â”€ Shop.tscn
â”‚   â”‚   â”œâ”€â”€ GeneticsCalculator.tscn
â”‚   â”‚   â””â”€â”€ VacationMode.tscn
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”œâ”€â”€ SnakeStats.gd
â”‚   â”‚   â”œâ”€â”€ SaveSystem.gd
â”‚   â”‚   â”œâ”€â”€ StripeAPI.gd
â”‚   â”‚   â””â”€â”€ GeneticsEngine.gd
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ snake_sprites/
â”‚   â”‚   â”œâ”€â”€ ui_icons/
â”‚   â”‚   â””â”€â”€ fonts/
â”‚   â””â”€â”€ export/ (HTML5 build output)
â”‚
â”œâ”€â”€ cloudflare-worker/
â”‚   â”œâ”€â”€ index.js (API + webhook handler)
â”‚   â”œâ”€â”€ wrangler.toml
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ website/ (GitHub Pages)
â”‚   â”œâ”€â”€ index.html (E-commerce site)
â”‚   â”œâ”€â”€ game/ (Godot HTML5 build)
â”‚   â”œâ”€â”€ forum/ (redirect to GitHub Discussions)
â”‚   â”œâ”€â”€ docs/ (care guides, SEO content)
â”‚   â””â”€â”€ assets/
â”‚
â”œâ”€â”€ stripe-products/ (JSON exports)
â”‚   â””â”€â”€ snakes.json (product catalog)
â”‚
â””â”€â”€ README.md (this doc)
```

---

## ğŸš€ QUICK START (MVP Implementation)

### Step 1: Set Up Godot (Week 1, Day 1)
```bash
# Download Godot 4.x
wget https://godotengine.org/download

# Create new project
godot --headless --new-project serpent-town-game

# Set HTML5 export template
# Project > Export > Add... > HTML5
```

### Step 2: Create First Scene (Week 1, Day 2)
```gdscript
# TownHub.tscn (root: Control)
# Add children:
#   - Label (title: "Serpent Town")
#   - Button (text: "My Farm")
#   - Button (text: "Shop")
#   - Button (text: "Calculator")

# TownHub.gd
extends Control

func _on_FarmButton_pressed():
    get_tree().change_scene("res://scenes/Farm.tscn")
```

### Step 3: Implement Snake Stats (Week 1, Day 3-5)
```gdscript
# SnakeStats.gd
extends Node
class_name SnakeStats

var hunger = 100
var water = 100
var temperature = 88
var humidity = 60
var health = 100
var stress = 0
var weight = 450
var shed_days_until = 14

func decay_stats(hours_passed):
    hunger -= 2 * hours_passed
    water -= 1 * hours_passed
    hunger = clamp(hunger, 0, 100)
    water = clamp(water, 0, 100)

func feed():
    hunger = 100
    
func give_water():
    water = 100
```

### Step 4: Connect to Stripe (Week 3)
```javascript
// Cloudflare Worker: index.js
export default {
  async fetch(request, env) {
    const url = new URL(request.url);
    
    if (url.pathname === '/api/products') {
      const stripe = new Stripe(env.STRIPE_SECRET_KEY);
      const products = await stripe.products.list({ active: true });
      return new Response(JSON.stringify(products.data), {
        headers: { 'Content-Type': 'application/json' }
      });
    }
    
    if (url.pathname === '/webhook/stripe') {
      // Handle purchase webhook
      const body = await request.json();
      // ... (see webhook handler above)
    }
    
    return new Response('Not Found', { status: 404 });
  }
}
```

### Step 5: Deploy (Week 6)
```bash
# Export Godot project to HTML5
# Project > Export > HTML5 > Export Project

# Deploy to GitHub Pages
git init
git add .
git commit -m "Initial Serpent Town MVP"
git push origin main

# Enable GitHub Pages (Settings > Pages > main branch)
# Site live at: https://yourusername.github.io/serpent-town/
```

---

## âœ… SUCCESS METRICS (v3 Finalized)

### Business (Primary Goals)
- **Snake Sales**: 500 sales/year (Year 1) â†’ 5,000 sales/year (Year 2)
- **Conversion Rate**: 5% (game users â†’ buyers)
- **Average Order Value**: $200-$450
- **Partner Farms**: 10 farms (Year 1) â†’ 50 farms (Year 2)
- **GMV**: $100K (Year 1) â†’ $1M (Year 2)

### Brand & Marketing
- **SEO**: Rank #1 for "ball python morphs", "snake genetics calculator"
- **Content**: 100 species guides, 500+ morph database
- **Community**: 10,000 active forum users
- **Social**: 50,000 Instagram followers
- **Referrals**: 30% of new users from referrals

### Product & Engagement
- **DAU**: 1,000 daily active users (Year 1)
- **Retention**: 40% D30 retention
- **Session Length**: 15 min average
- **Collections**: Average 5 snakes per user
- **Breeding**: 1,000 virtual breeding attempts/month

---

## ğŸ‰ CONCLUSION (v3.0 - FINAL SPEC)

**Serpent Town v3.0 is a complete, implementable specification** using:
- âœ… **Godot game engine** (HTML5 export, JavaScript)
- âœ… **Stripe product system** (snake photos, data)
- âœ… **GitHub Pages hosting** (free, reliable)
- âœ… **Cloudflare Worker backend** (serverless, edge)
- âœ… **Full genetics calculator** (core feature from day 1)
- âœ… **Realistic care mechanics** (8 stats, vacation mode, time slider)
- âœ… **No duplication** (forum web + in-game = same platform)
- âœ… **Real vs virtual UX** (color-coded cards, clear distinction)
- âœ… **Free in-game care for buyers** (engagement incentive)

### What's Different from v2.0?
| Aspect | v2.0 | v3.0 (FINAL) |
|--------|------|--------------|
| **Game Engine** | React + TypeScript | Godot + JavaScript |
| **Tech Stack** | Complex (multiple frameworks) | Simple (Godot + Cloudflare) |
| **Genetics** | "Phase 3 feature" | **Core feature from MVP** |
| **Forum** | Separate implementation | Single platform (web + in-game) |
| **Data** | New schema (breaking) | Stripe-compatible (existing) |
| **Existing Code** | Rewrite everything | Leverage existing products.json |
| **Premium Model** | Unclear | **Free care for real buyers** |
| **Vacation Mode** | Vague | **Detailed implementation** |
| **Time System** | Unclear | **Real-time + fast-forward slider** |

---

## ğŸš€ IMMEDIATE NEXT STEPS

**This Week**:
1. âœ… Install Godot 4.x
2. âœ… Create new project: "serpent-town-game"
3. âœ… Set up HTML5 export
4. âœ… Create TownHub.tscn (first scene)
5. âœ… Create SnakeStats.gd (core logic)

**Next Week**:
1. Implement Farm.tscn (snake grid)
2. Implement SnakeCare.tscn (Tamagotchi UI)
3. Add stat decay logic (real-time)
4. Add action buttons (feed, water)
5. Test in browser (HTML5 export)

**Week 3**:
1. Set up Cloudflare Worker
2. Integrate Stripe API (fetch products)
3. Display real snakes in Shop.tscn
4. Test webhook (purchase â†’ unlock)

---

**Document Version**: 3.0 (FINAL)
**Last Updated**: 2025-12-21
**Status**: âœ… READY FOR IMPLEMENTATION
**Start Date**: Immediate

**Let's build Serpent Town! ğŸğŸ®ğŸš€**
