<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Cache Status Check</title>
  <style>
    body {
      font-family: monospace;
      background: #0a0e14;
      color: #c9d1d9;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    .status {
      background: #161b22;
      border: 2px solid #30363d;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .ok { color: #3fb950; }
    .warn { color: #f85149; }
    button {
      background: #238636;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h1>üîç Cache Status Check</h1>
  
  <div class="status" id="status">Checking...</div>
  
  <button onclick="checkCache()">üîÑ Recheck</button>
  <button onclick="clearCache()">üóëÔ∏è Clear Cache</button>
  <button onclick="forceCache()">üíæ Force Cache Now</button>
  
  <script>
    function checkCache() {
      const status = document.getElementById('status');
      let html = '';
      
      const cached = localStorage.getItem('serpent_products_cache');
      const cacheTime = localStorage.getItem('serpent_products_cache_time');
      
      if (cached && cacheTime) {
        const age = Date.now() - parseInt(cacheTime);
        const ageMin = Math.floor(age / 60000);
        const ageSec = Math.floor((age % 60000) / 1000);
        const products = JSON.parse(cached);
        
        html += '<div class="ok">‚úÖ CACHE EXISTS!</div>';
        html += `<div>üì¶ Products: ${products.length}</div>`;
        html += `<div>üìè Size: ${(cached.length / 1024).toFixed(2)} KB</div>`;
        html += `<div>‚è±Ô∏è  Age: ${ageMin}m ${ageSec}s</div>`;
        html += `<div>‚è∞ Expires: ${Math.max(0, 300 - Math.floor(age / 1000))}s</div>`;
        
        if (age > 300000) {
          html += '<div class="warn">‚ö†Ô∏è Cache EXPIRED (>5 min)</div>';
        } else {
          html += '<div class="ok">‚úÖ Cache is FRESH</div>';
        }
      } else {
        html += '<div class="warn">‚ùå NO CACHE FOUND</div>';
        html += '<div>Cache will be created on first catalog visit</div>';
      }
      
      // Test localStorage
      try {
        localStorage.setItem('test', '1');
        localStorage.removeItem('test');
        html += '<div class="ok">‚úÖ localStorage works</div>';
      } catch(e) {
        html += `<div class="warn">‚ùå localStorage blocked: ${e.message}</div>`;
      }
      
      status.innerHTML = html;
    }
    
    function clearCache() {
      localStorage.removeItem('serpent_products_cache');
      localStorage.removeItem('serpent_products_cache_time');
      alert('üóëÔ∏è Cache cleared! Reload catalog page to re-cache.');
    }
    
    async function forceCache() {
      const status = document.getElementById('status');
      status.innerHTML = '<div>üì° Fetching from API...</div>';
      
      try {
        const start = Date.now();
        const response = await fetch('https://catalog.navickaszilvinas.workers.dev/products');
        const data = await response.json();
        const duration = Date.now() - start;
        
        localStorage.setItem('serpent_products_cache', JSON.stringify(data));
        localStorage.setItem('serpent_products_cache_time', Date.now().toString());
        
        status.innerHTML = `<div class="ok">‚úÖ Cached ${data.length} products in ${duration}ms!</div>`;
        setTimeout(checkCache, 500);
      } catch (error) {
        status.innerHTML = `<div class="warn">‚ùå Failed: ${error.message}</div>`;
      }
    }
    
    // Auto-check on load
    checkCache();
  </script>
</body>
</html>
