<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üêç Snake Dex - Professional Pokedex</title>
  <style>
    /* SPDX-FileCopyrightText: 2024-2026 vinas8 (Serpent Town) */
    /* SPDX-License-Identifier: MIT */
    /* UI architecture adapted from PokeRogue (AGPL-3.0) - see /CREDITS.md */
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Courier New', monospace;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Header - Pokedex style */
    .dex-header {
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
      padding: 2rem;
      text-align: center;
      border-bottom: 3px solid #ffd700;
    }

    .dex-title {
      font-size: 3rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      margin-bottom: 1rem;
    }

    .dex-stats {
      display: flex;
      justify-content: center;
      gap: 3rem;
      margin-top: 1.5rem;
    }

    .stat-box {
      text-align: center;
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: bold;
      color: #ffd700;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    .stat-label {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.8);
      margin-top: 0.3rem;
    }

    /* Controls */
    .dex-controls {
      background: rgba(0, 0, 0, 0.3);
      padding: 1.5rem;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    }

    .controls-row {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      min-width: 300px;
    }

    .search-input {
      width: 100%;
      padding: 0.8rem 1.2rem;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      color: #fff;
      font-size: 1rem;
      font-family: 'Courier New', monospace;
    }

    .search-input::placeholder { color: rgba(255, 255, 255, 0.5); }
    .search-input:focus {
      outline: none;
      border-color: #ffd700;
      background: rgba(255, 255, 255, 0.15);
    }

    .filter-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 0.7rem 1.2rem;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Courier New', monospace;
    }

    .filter-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: #ffd700;
    }

    .filter-btn.active {
      background: #ffd700;
      color: #000;
      border-color: #ffd700;
    }

    /* Grid - Pokedex 9-column layout */
    .dex-container {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 2rem;
    }

    .dex-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(145px, 1fr));
      gap: 1rem;
      padding: 2rem 0;
    }

    /* Snake Card - Compact Pokedex style */
    .snake-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      text-align: center;
    }

    .snake-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
      border-color: #ffd700;
      background: rgba(255, 255, 255, 0.15);
    }

    .snake-card.owned {
      border-color: #ffd700;
      background: rgba(255, 215, 0, 0.15);
    }

    .snake-number {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 0.5rem;
    }

    .snake-icon {
      font-size: 3rem;
      margin: 0.5rem 0;
      filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
    }

    .snake-name {
      font-size: 0.95rem;
      font-weight: bold;
      margin: 0.5rem 0;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    .gene-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.65rem;
      font-weight: bold;
      margin: 0.3rem 0;
    }

    .gene-dominant { background: #ff6b6b; }
    .gene-codominant { background: #ffd700; color: #000; }
    .gene-recessive { background: #4dabf7; }

    .snake-price {
      font-size: 0.85rem;
      color: #ffd700;
      font-weight: bold;
      margin-top: 0.5rem;
    }

    .health-risk {
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 1.2rem;
      filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.5));
    }

    .owned-badge {
      position: absolute;
      top: 5px;
      left: 5px;
      background: #ffd700;
      color: #000;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    /* Detail Modal */
    .detail-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .detail-modal.active {
      display: flex;
    }

    .detail-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: 3px solid #ffd700;
      border-radius: 15px;
      padding: 2rem;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }

    .detail-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid #ffd700;
      color: #ffd700;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .detail-icon {
      font-size: 5rem;
      text-align: center;
      margin: 1rem 0;
    }

    .detail-name {
      font-size: 2rem;
      text-align: center;
      margin-bottom: 0.5rem;
    }

    .detail-section {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
    }

    .detail-label {
      color: #ffd700;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .detail-value {
      color: rgba(255, 255, 255, 0.9);
    }

    .loading {
      text-align: center;
      padding: 3rem;
      font-size: 1.2rem;
      color: rgba(255, 255, 255, 0.7);
    }
  </style>
</head>
<body>
  <div class="dex-header">
    <h1 class="dex-title">üêç SNAKE DEX</h1>
    <p>Gotta Catch 'Em All!</p>
    
    <div class="dex-stats">
      <div class="stat-box">
        <div class="stat-value" id="stat-owned">0</div>
        <div class="stat-label">Owned</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="stat-total">50</div>
        <div class="stat-label">Discovered</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="stat-completion">0%</div>
        <div class="stat-label">Completion</div>
      </div>
    </div>
  </div>

  <div class="dex-controls">
    <div class="controls-row">
      <div class="search-box">
        <input 
          type="text" 
          id="search" 
          class="search-input" 
          placeholder="üîç Search morphs..."
        >
      </div>
      
      <div class="filter-group">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="owned">Owned</button>
        <button class="filter-btn" data-filter="dominant">Dominant</button>
        <button class="filter-btn" data-filter="co-dominant">Co-Dom</button>
        <button class="filter-btn" data-filter="recessive">Recessive</button>
      </div>
    </div>
  </div>

  <div class="dex-container">
    <div id="dex-grid" class="dex-grid">
      <div class="loading">Loading morph database...</div>
    </div>
  </div>

  <!-- Detail Modal -->
  <div id="detail-modal" class="detail-modal">
    <div class="detail-content">
      <div class="detail-close" onclick="closeDetail()">√ó</div>
      <div id="detail-body"></div>
    </div>
  </div>

  <script type="module">
    import { SnakeDexContainer } from './modules/snake-dex-container.js';
    import { MorphDataLoader } from './modules/morph-data-loader.js';

    const loader = new MorphDataLoader();
    let containers = [];
    let currentFilter = 'all';
    let searchQuery = '';
    let ownedMorphs = [];

    async function init() {
      const morphs = await loader.load();
      
      if (morphs.length === 0) {
        document.getElementById('dex-grid').innerHTML = '<div class="loading">Failed to load morph data</div>';
        return;
      }

      loadOwnedMorphs();
      renderGrid(morphs);
      updateStats();
    }

    function loadOwnedMorphs() {
      // TODO: Load from worker/KV
      ownedMorphs = JSON.parse(localStorage.getItem('owned_morphs') || '[]');
    }

    function renderGrid(morphs) {
      const grid = document.getElementById('dex-grid');
      grid.innerHTML = '';
      
      morphs.forEach(morph => {
        const owned = ownedMorphs.includes(morph.id);
        const container = new SnakeDexContainer(morph, owned);
        containers.push(container);
        grid.appendChild(container.element);
      });
    }

    function filterAndSearch() {
      let filtered = loader.morphs;

      // Apply search
      if (searchQuery) {
        filtered = loader.searchMorphs(searchQuery);
      }

      // Apply filter
      if (currentFilter === 'owned') {
        filtered = filtered.filter(m => ownedMorphs.includes(m.id));
      } else if (currentFilter !== 'all') {
        filtered = loader.getMorphsByGeneType(currentFilter);
      }

      // Clear and re-render
      containers.forEach(c => c.destroy());
      containers = [];
      renderGrid(filtered);
      updateStats();
    }

    function updateStats() {
      const stats = loader.getStats();
      document.getElementById('stat-owned').textContent = ownedMorphs.length;
      document.getElementById('stat-total').textContent = loader.morphs.length;
      const completion = loader.morphs.length > 0 
        ? Math.round((ownedMorphs.length / loader.morphs.length) * 100) 
        : 0;
      document.getElementById('stat-completion').textContent = `${completion}%`;
    }

    // Search handler
    document.getElementById('search').addEventListener('input', (e) => {
      searchQuery = e.target.value;
      filterAndSearch();
    });

    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.filter;
        filterAndSearch();
      });
    });

    // Detail view
    document.addEventListener('snake-selected', (e) => {
      showDetail(e.detail.morph, e.detail.owned);
    });

    window.showDetail = function(morph, owned) {
      const modal = document.getElementById('detail-modal');
      const body = document.getElementById('detail-body');
      
      body.innerHTML = `
        <div class="detail-icon">${morph.emoji}üêç</div>
        <h2 class="detail-name">#${String(morph.index).padStart(3, '0')} ${morph.name}</h2>
        
        <div class="detail-section">
          <div class="detail-label">Gene Type</div>
          <div class="detail-value">${morph.gene_type.toUpperCase()}</div>
        </div>

        ${morph.super_form ? `
          <div class="detail-section">
            <div class="detail-label">Super Form</div>
            <div class="detail-value">${morph.super_form}</div>
          </div>
        ` : ''}

        <div class="detail-section">
          <div class="detail-label">Market Value</div>
          <div class="detail-value">$${morph.market_value_usd} USD</div>
        </div>

        <div class="detail-section">
          <div class="detail-label">Rarity</div>
          <div class="detail-value">${morph.rarity.toUpperCase()}</div>
        </div>

        ${morph.health_risk !== 'none' ? `
          <div class="detail-section">
            <div class="detail-label">‚ö†Ô∏è Health Risk: ${morph.health_risk.toUpperCase()}</div>
            <div class="detail-value">${morph.health_issues.join('. ')}</div>
          </div>
        ` : ''}

        ${morph.breeding_notes ? `
          <div class="detail-section">
            <div class="detail-label">Breeding Notes</div>
            <div class="detail-value">${morph.breeding_notes}</div>
          </div>
        ` : ''}

        ${morph.aliases.length > 0 ? `
          <div class="detail-section">
            <div class="detail-label">Also Known As</div>
            <div class="detail-value">${morph.aliases.join(', ')}</div>
          </div>
        ` : ''}

        <div class="detail-section">
          <div class="detail-label">Status</div>
          <div class="detail-value">${owned ? '‚úÖ OWNED' : '‚ùå NOT OWNED'}</div>
        </div>
      `;
      
      modal.classList.add('active');
    };

    window.closeDetail = function() {
      document.getElementById('detail-modal').classList.remove('active');
    };

    // Close on outside click
    document.getElementById('detail-modal').addEventListener('click', (e) => {
      if (e.target.id === 'detail-modal') closeDetail();
    });

    init();
  </script>
</body>
</html>
