<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé¨ Interactive Demo - Snake Muffin</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
  </style>
</head>
<body>
  <div id="demo-root"></div>

  <script type="module">
    import { Demo } from '/src/modules/demo/index.js';

    const demo = new Demo({
      containerId: 'demo-root',
      scenarios: [
        {
          icon: 'üõí',
          title: 'Shop & Browse Products',
          smri: 'S1.1,2,3.01',
          description: 'Browse catalog ‚Üí View details ‚Üí See pricing',
          steps: [
            {
              title: 'Browse Catalog',
              description: 'View available snakes',
              url: '/catalog.html',
              action: async (demo) => {
                demo.log('üì¶ Loading product catalog...', 'info');
                await demo.wait(2000);
                demo.log('‚úÖ Products loaded! You should see snakes below', 'success');
                demo.log('üí∞ Prices: ‚Ç¨180-‚Ç¨650 depending on morph', 'info');
              }
            },
            {
              title: 'View Snake Details',
              description: 'Click "View Details" button',
              url: '/catalog.html',
              action: async (demo) => {
                demo.log('‚è≥ Waiting for products to render...', 'info');
                await demo.wait(2000);
                demo.log('üëâ Click "‚ÑπÔ∏è View Details" button on any snake', 'info');
                demo.log('üìã Modal should open with full info:', 'info');
                demo.log('   ‚Ä¢ Species & morph details', 'info');
                demo.log('   ‚Ä¢ Physical stats (size, weight)', 'info');
                demo.log('   ‚Ä¢ Genetics information', 'info');
                await demo.wait(3000);
              }
            },
            {
              title: 'Check Pricing',
              description: 'View product prices',
              url: '/catalog.html',
              action: async (demo) => {
                demo.log('üí∂ All products show prices', 'success');
                demo.log('‚ö†Ô∏è Note: Stripe checkout requires payment links', 'info');
                demo.log('   (Products need Stripe links for live checkout)', 'info');
                await demo.wait(2000);
              }
            }
          ]
        },
        {
          icon: 'üéÆ',
          title: 'Game Tutorial',
          smri: 'S2.7,5,5-1.01',
          description: 'Learn to care for your snake',
          steps: [
            {
              title: 'Check Your Snakes',
              description: 'Ensure you have snakes assigned',
              url: '/game.html',
              action: async (demo) => {
                demo.log('üîç Checking if you have snakes...', 'info');
                await demo.wait(1500);
                demo.log('‚ö†Ô∏è If no snakes appear:', 'info');
                demo.log('   1. Import CSV data (Owner Dashboard)', 'info');
                demo.log('   2. Purchase from catalog', 'info');
                demo.log('   3. Snakes must be assigned to your user', 'info');
                await demo.wait(3000);
              }
            },
            {
              title: 'Select a Snake',
              description: 'Click on snake card',
              url: '/game.html',
              action: async (demo) => {
                demo.log('üëÜ Click on any snake card to select it', 'info');
                await demo.wait(2000);
              }
            },
            {
              title: 'Feed Snake',
              description: 'Click feed button',
              url: '/game.html',
              action: async (demo) => {
                demo.log('üçñ Click the "Feed" button', 'info');
                await demo.wait(2000);
              }
            },
            {
              title: 'Give Water',
              description: 'Click water button',
              url: '/game.html',
              action: async (demo) => {
                demo.log('üíß Click the "Water" button', 'info');
                await demo.wait(2000);
              }
            },
            {
              title: 'Clean Enclosure',
              description: 'Click clean button',
              url: '/game.html',
              action: async (demo) => {
                demo.log('üßπ Click the "Clean" button', 'info');
                await demo.wait(2000);
              }
            },
            {
              title: 'Check Stats',
              description: 'View snake health metrics',
              url: '/game.html',
              action: async (demo) => {
                demo.log('üìä All stats should be 100%', 'success');
                await demo.wait(1000);
              }
            }
          ]
        },
        {
          icon: 'üëî',
          title: 'Owner Dashboard - Complete Import Flow',
          smri: 'S6.1,4,5.01',
          description: 'CSV ‚Üí KV ‚Üí Stripe ‚Üí KV ‚Üí Catalog',
          steps: [
            {
              title: 'Step 1: CSV to KV',
              description: 'Import catalog data to KV (source of truth)',
              url: '/admin/import.html',
              action: async (demo) => {
                demo.log('üì§ CSV ‚Üí KV Flow:', 'info');
                demo.log('1. Upload CSV or paste data', 'info');
                demo.log('2. Data stored in KV (source of truth)', 'info');
                demo.log('üí° KV = All website data lives here', 'success');
                await demo.wait(3000);
              }
            },
            {
              title: 'Step 2: KV to Stripe',
              description: 'Create payment products in Stripe',
              url: '/admin/import.html',
              action: async (demo) => {
                demo.log('‚¨ÜÔ∏è KV ‚Üí Stripe:', 'info');
                demo.log('1. Export from KV to Stripe', 'info');
                demo.log('2. Creates products + prices + payment links', 'info');
                demo.log('üí≥ Stripe = Payment processor only', 'success');
                await demo.wait(3000);
              }
            },
            {
              title: 'Step 3: Sync Links to KV',
              description: 'Save payment links back to KV',
              url: '/admin/import.html',
              action: async (demo) => {
                demo.log('üîÑ Stripe ‚Üí KV (sync):', 'info');
                demo.log('1. Stripe created payment links', 'info');
                demo.log('2. Save links back to KV', 'info');
                demo.log('‚úÖ KV now has products WITH payment links', 'success');
                await demo.wait(3000);
              }
            },
            {
              title: 'Step 4: View in Catalog',
              description: 'See products with working Buy buttons',
              url: '/catalog.html',
              action: async (demo) => {
                demo.log('üîÑ Clearing cache to show fresh products...', 'info');
                const iframe = document.getElementById('demo-iframe');
                if (iframe && iframe.contentWindow) {
                  try {
                    iframe.contentWindow.localStorage.removeItem('serpent_products_cache');
                    iframe.contentWindow.localStorage.removeItem('serpent_products_cache_time');
                    demo.log('‚úÖ Cache cleared!', 'success');
                  } catch (e) {
                    demo.log('‚ö†Ô∏è Could not clear cache (CORS)', 'info');
                  }
                }
                await demo.wait(1500);
                demo.reloadIframe();
                demo.log('üì¶ Products visible with "Buy Now" buttons!', 'success');
                demo.log('üéØ Flow: CSV ‚Üí KV ‚Üí Stripe ‚Üí KV ‚Üí Catalog', 'info');
              }
            },
            {
              title: 'Architecture Summary',
              description: 'Understanding the data flow',
              url: '/admin/import.html',
              action: async (demo) => {
                demo.log('üìä ARCHITECTURE:', 'info');
                demo.log('‚îÅ'.repeat(50), 'info');
                demo.log('KV (Cloudflare)     = SOURCE OF TRUTH', 'success');
                demo.log('  ‚úì All product data', 'info');
                demo.log('  ‚úì Ownership records', 'info');
                demo.log('  ‚úì Payment status', 'info');
                demo.log('', 'info');
                demo.log('Stripe              = Payment processor', 'success');
                demo.log('  ‚úì Checkout links', 'info');
                demo.log('  ‚úì Payment processing', 'info');
                demo.log('', 'info');
                demo.log('LocalStorage        = Cache', 'success');
                demo.log('  ‚úì Mirrors KV', 'info');
                demo.log('  ‚úì Fast access', 'info');
                await demo.wait(5000);
              }
            }
          ]
        }
      ]
    });

    demo.init();
    console.log('üé¨ Demo system initialized');
  </script>
</body>
</html>
